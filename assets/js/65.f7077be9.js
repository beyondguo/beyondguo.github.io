(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{437:function(s,t,a){"use strict";a.r(t);var n=a(44),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[a("strong",[s._v("ã€ŒHuggingfaceğŸ¤—NLPç¬”è®°ç³»åˆ—-ç¬¬8é›†ã€")]),s._v("\nHuggingfaceåˆçº§æ•™ç¨‹å®Œç»“æ’’èŠ±ï¼ğŸŒ¸ğŸŒ¼ãƒ½(Â°â–½Â°)ãƒğŸŒ¸ğŸŒº\næœ€è¿‘è·Ÿç€Huggingfaceä¸Šçš„NLP tutorialèµ°äº†ä¸€éï¼ŒæƒŠå¹å±…ç„¶æœ‰å¦‚æ­¤å¥½çš„è®²è§£Transformersç³»åˆ—çš„NLPæ•™ç¨‹ï¼Œäºæ˜¯å†³å®šè®°å½•ä¸€ä¸‹å­¦ä¹ çš„è¿‡ç¨‹ï¼Œåˆ†äº«æˆ‘çš„ç¬”è®°ï¼Œå¯ä»¥ç®—æ˜¯å®˜æ–¹æ•™ç¨‹çš„"),a("strong",[s._v("ç²¾ç®€+æ³¨è§£ç‰ˆ")]),s._v("ã€‚ä½†æœ€æ¨èçš„ï¼Œè¿˜æ˜¯ç›´æ¥è·Ÿç€å®˜æ–¹æ•™ç¨‹æ¥ä¸€éï¼ŒçœŸæ˜¯ä¸€ç§äº«å—ã€‚")])]),s._v(" "),a("ul",[a("li",[s._v("å®˜æ–¹æ•™ç¨‹ç½‘å€ï¼šhttps://huggingface.co/course/chapter1")]),s._v(" "),a("li",[s._v("æœ¬æœŸå†…å®¹å¯¹åº”ç½‘å€ï¼šhttps://huggingface.co/course/chapter3/4?fw=pt")]),s._v(" "),a("li",[s._v("æœ¬ç³»åˆ—ç¬”è®°çš„"),a("strong",[s._v("GitHub Notebook(å¯ä¸‹è½½ç›´æ¥è¿è¡Œ)")]),s._v("ï¼š https://github.com/beyondguo/Learn_PyTorch/tree/master/HuggingfaceNLP")])]),s._v(" "),a("hr"),s._v(" "),a("h1",{attrs:{id:"æ›´åŠ é€æ˜çš„æ–¹å¼-ä½¿ç”¨pytorchæ¥å¾®è°ƒæ¨¡å‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ›´åŠ é€æ˜çš„æ–¹å¼-ä½¿ç”¨pytorchæ¥å¾®è°ƒæ¨¡å‹"}},[s._v("#")]),s._v(" æ›´åŠ é€æ˜çš„æ–¹å¼â€”â€”ä½¿ç”¨PyTorchæ¥å¾®è°ƒæ¨¡å‹")]),s._v(" "),a("p",[s._v("è¿™é‡Œæˆ‘ä»¬ä¸ä½¿ç”¨Trainerè¿™ä¸ªé«˜çº§APIï¼Œè€Œæ˜¯ç”¨pytorchæ¥å®ç°ã€‚")]),s._v(" "),a("h2",{attrs:{id:"_1-æ•°æ®é›†é¢„å¤„ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ•°æ®é›†é¢„å¤„ç†"}},[s._v("#")]),s._v(" 1. æ•°æ®é›†é¢„å¤„ç†")]),s._v(" "),a("p",[s._v("åœ¨Huggingfaceå®˜æ–¹æ•™ç¨‹é‡Œæåˆ°ï¼Œåœ¨ä½¿ç”¨pytorchçš„dataloaderä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›äº‹æƒ…ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("æŠŠdatasetä¸­ä¸€äº›ä¸éœ€è¦çš„åˆ—ç»™å»æ‰äº†ï¼Œæ¯”å¦‚â€˜sentence1â€™ï¼Œâ€˜sentence2â€™ç­‰")]),s._v(" "),a("li",[s._v("æŠŠæ•°æ®è½¬æ¢æˆpytorch tensors")]),s._v(" "),a("li",[s._v("ä¿®æ”¹åˆ—å label ä¸º labels")])]),s._v(" "),a("p",[s._v("å…¶ä»–çš„éƒ½å¥½è¯´ï¼Œä½†"),a("strong",[s._v("ä¸ºå•¥è¦ä¿®æ”¹åˆ—å label ä¸º labelsï¼Œå¥½å¥‡æ€ªå“¦ï¼")]),s._v("\nè¿™é‡Œæ¢ç©¶ä¸€ä¸‹ï¼š")]),s._v(" "),a("p",[s._v('é¦–å…ˆï¼ŒHuggingfaceçš„è¿™äº›transformer Modelç›´æ¥callçš„æ—¶å€™ï¼Œæ¥å—çš„æ ‡ç­¾è¿™ä¸ªå‚æ•°æ˜¯å«"labels"ã€‚\næ‰€ä»¥ä¸ç®¡ä½ ä½¿ç”¨Trainerï¼Œè¿˜æ˜¯åŸç”Ÿpytorchå»å†™ï¼Œæœ€ç»ˆæ¨¡å‹å¤„ç†çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯ä½¿ç”¨çš„åä¸º"labels"çš„æ ‡ç­¾å‚æ•°ã€‚')]),s._v(" "),a("p",[s._v('ä½†åœ¨Huggingfaceçš„datasetsä¸­ï¼Œæ•°æ®é›†çš„æ ‡ç­¾ä¸€èˆ¬å‘½åä¸º"label"æˆ–è€…"label_ids"ï¼Œé‚£ä¸ºä»€ä¹ˆåœ¨å‰ä¸¤é›†ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰å¯¹æ ‡ç­¾åè¿›è¡Œå¤„ç†å‘¢ï¼Ÿ')]),s._v(" "),a("p",[s._v("è¿™ä¸€ç‚¹åœ¨transformerçš„æºç "),a("code",[s._v("trainer.py")]),s._v("é‡Œæ‰¾åˆ°äº†ç«¯å€ªï¼š")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä½ç½®åœ¨def _remove_unused_columnså‡½æ•°é‡Œ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Labels may be named label or label_ids, the default data collator handles that.")]),s._v("\nsignature_columns "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label_ids"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("è¿™é‡Œæç¤ºäº†ï¼Œ data collator ä¼šè´Ÿè´£å¤„ç†æ ‡ç­¾é—®é¢˜ã€‚ç„¶åæˆ‘åˆå»æŸ¥çœ‹äº†"),a("code",[s._v("data_collator.py")]),s._v("ä¸­å‘ç°äº†ä¸€ä¸‹å†…å®¹ï¼š")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DataCollatorWithPadding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("__call__")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" features"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" List"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Dict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("List"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Tensor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Dict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Tensor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"labels"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("del")]),s._v(" batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label_ids"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"labels"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label_ids"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("del")]),s._v(" batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"label_ids"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" batch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v('è¿™å°±çœŸç›¸å¤§ç™½äº†ï¼šä¸ç®¡æ•°æ®é›†ä¸­æä¾›çš„æ ‡ç­¾åå«"label"ï¼Œè¿˜æ˜¯"label_ids"ï¼Œ\nDataCollatorWithPadding éƒ½ä¼šå¸®ä½ è½¬æ¢æˆ"labels"ï¼Œè£…è¿›batché‡Œï¼Œå†è¿”å›ã€‚')]),s._v(" "),a("p",[s._v("å‰é¢ä½¿ç”¨Trainerçš„æ—¶å€™ï¼ŒDataCollatorWithPaddingå·²ç»å¸®æˆ‘ä»¬è‡ªåŠ¨è½¬æ¢äº†ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦æ“å¿ƒè¿™ä¸ªé—®é¢˜ã€‚")]),s._v(" "),a("p",[s._v("ä½†è¿™å°±æ˜¯è®©æˆ‘ç–‘æƒ‘çš„åœ°æ–¹ï¼šæˆ‘ä»¬ä½¿ç”¨pytorchæ¥å†™ï¼Œå…¶å®ä¹Ÿä¸ç”¨ç®¡è¿™ä¸ªï¼Œå› ä¸ºåœ¨pytorchçš„data_loaderé‡Œé¢ï¼Œæœ‰ä¸€ä¸ª"),a("code",[s._v("collate_fn")]),s._v('å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠDataCollatorWithPaddingå¯¹è±¡ä¼ è¿›å»ï¼Œä¹Ÿä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨æŠŠ"label"è½¬æ¢æˆ"labels"ã€‚å› æ­¤å®é™…ä¸Šï¼Œ'),a("strong",[s._v("è¿™åº”è¯¥æ˜¯æ•™ç¨‹ä¸­çš„ä¸€ä¸ªå°é”™è¯¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨è®¾è®¡")]),s._v("ï¼ˆå‰ä¸¤å¤©åœ¨Huggingface GitHubä¸Šæäº†issueï¼Œä½œè€…å›å¤æˆ‘ç¡®å®ä¸ç”¨æ‰‹åŠ¨è®¾ç½®ï¼‰ã€‚")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("ä¸‹é¢å¼€å§‹æ­£å¼ä½¿ç”¨pytorchæ¥è®­ç»ƒï¼š")]),s._v(" "),a("p",[s._v("é¦–å…ˆæ˜¯è·Ÿä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦åŠ è½½æ•°æ®é›†ã€tokenizerï¼Œç„¶åæŠŠæ•°æ®é›†é€šè¿‡mapçš„æ–¹å¼è¿›è¡Œé¢„å¤„ç†ã€‚æˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰ä¸€ä¸ª"),a("code",[s._v("data_collator")]),s._v("æ–¹ä¾¿æˆ‘ä»¬åé¢è¿›è¡Œæ‰¹é‡åŒ–å¤„ç†æ¨¡å‹ï¼š")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" datasets "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" load_dataset\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" transformers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" AutoTokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" DataCollatorWithPadding\n\nraw_datasets "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" load_dataset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"glue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mrpc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncheckpoint "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bert-base-uncased"')]),s._v("\ntokenizer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" AutoTokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("from_pretrained"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("checkpoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tokenize_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("example"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" tokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("example"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sentence1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" example"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sentence2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" truncation"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\ntokenized_datasets "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" raw_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tokenize_function"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" batched"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndata_collator "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataCollatorWithPadding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tokenizer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("æŸ¥çœ‹ä¸€ä¸‹å¤„ç†åçš„datasetï¼š")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'train'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("column_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'attention_mask'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'idx'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'input_ids'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'label'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sentence1'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sentence2'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'token_type_ids'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("huggingface datasetsè´´å¿ƒåœ°å‡†å¤‡äº†ä¸‰ä¸ªæ–¹æ³•ï¼š"),a("code",[s._v("remove_columns")]),s._v(", "),a("code",[s._v("rename_column")]),s._v(", "),a("code",[s._v("set_format")])]),s._v(" "),a("p",[s._v("æ¥æ–¹ä¾¿æˆ‘ä»¬ä¸ºpytorchçš„Dataloaderåšå‡†å¤‡ï¼š")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("tokenized_datasets "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("remove_columns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sentence1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sentence2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'idx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tokenized_datasets = tokenized_datasets.rename_column('label','labels')  # å®è·µè¯æ˜ï¼Œè¿™ä¸€è¡Œæ˜¯ä¸éœ€è¦çš„")]),s._v("\ntokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("set_format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'torch'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'train'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("column_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'attention_mask'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'input_ids'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'label'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'token_type_ids'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("æŸ¥çœ‹ä¸€ä¸‹ï¼š")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'train'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç»è¿‡ä¸Šé¢çš„å¤„ç†ï¼Œå®ƒå°±å¯ä»¥ç›´æ¥ä¸¢è¿›pytorchçš„Dataloaderä¸­äº†ï¼Œè·Ÿpytorchä¸­çš„Datasetæ ¼å¼å·²ç»ä¸€æ ·äº†")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nDataset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    features: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'attention_mask'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'input_ids'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'label'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'token_type_ids'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    num_rows: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3668")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("å®šä¹‰æˆ‘ä»¬çš„"),a("strong",[s._v("pytorch dataloaders")]),s._v("ï¼š")]),s._v(" "),a("p",[s._v("åœ¨pytorchçš„"),a("code",[s._v("DataLoader")]),s._v("é‡Œï¼Œæœ‰ä¸€ä¸ª"),a("code",[s._v("collate_fn")]),s._v('å‚æ•°ï¼Œå…¶å®šä¹‰æ˜¯ï¼š"merges a list of samples to form a mini-batch of Tensor(s).  Used when using batched loading from a map-style dataset." æˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠHuggingfaceçš„'),a("code",[s._v("DataCollatorWithPadding")]),s._v("å¯¹è±¡ä¼ è¿›å»ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œpaddingç­‰ä¸€ç³»åˆ—å¤„ç†ï¼š")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" DataLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Dataset\ntrain_dataloader "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'train'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" shuffle"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" batch_size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" collate_fn"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("data_collator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é€šè¿‡è¿™é‡Œçš„dataloaderï¼Œæ¯ä¸ªbatchçš„seq_lenå¯èƒ½ä¸åŒ")]),s._v("\neval_dataloader "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'validation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" batch_size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" collate_fn"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("data_collator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹ä¸€ä¸‹train_dataloaderçš„å…ƒç´ é•¿å•¥æ ·")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" batch "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" train_dataloader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shape "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯è§éƒ½æ˜¯é•¿åº¦ä¸º72ï¼Œsize=8çš„batch")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'attention_mask'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" torch.Size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'input_ids'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" torch.Size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'token_type_ids'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" torch.Size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'labels'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" torch.Size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("è§‚å¯Ÿä¸€ä¸‹ç»è¿‡DataLoaderå¤„ç†åçš„æ•°æ®ï¼Œæˆ‘ä»¬å‘ç°ï¼Œæ ‡ç­¾é‚£ä¸€åˆ—çš„åˆ—åï¼Œå·²ç»ä»"),a("code",[s._v('"label"')]),s._v("å˜ä¸º"),a("code",[s._v('"labels"')]),s._v("äº†ï¼")]),s._v(" "),a("h2",{attrs:{id:"_2-æ¨¡å‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ¨¡å‹"}},[s._v("#")]),s._v(" 2. æ¨¡å‹")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" transformers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" AutoModelForSequenceClassification\n\nmodel "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" AutoModelForSequenceClassification"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("from_pretrained"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("checkpoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" num_labels"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("å‰é¢dataloaderå‡ºæ¥çš„batchå¯ä»¥ç›´æ¥ä¸¢è¿›æ¨¡å‹å¤„ç†ï¼š")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nSequenceClassifierOutput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("loss"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tensor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.7563")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("grad_fn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("NllLossBackward"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("logits")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tensor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-0.2171, -0.4416"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-0.2248, -0.4694"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-0.2440, -0.4664"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-0.2421, -0.4510"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-0.2273, -0.4545"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-0.2339, -0.4515"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-0.2334, -0.4387"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-0.2362, -0.4601"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("grad_fn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("AddmmBackward"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hidden_states")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("None, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("attentions")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("None"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"å®šä¹‰-optimizer-å’Œ-learning-rate-scheduler"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®šä¹‰-optimizer-å’Œ-learning-rate-scheduler"}},[s._v("#")]),s._v(" å®šä¹‰ optimizer å’Œ learning rate scheduler")]),s._v(" "),a("p",[s._v("æŒ‰é“ç†è¯´ï¼ŒHuggingfaceè¿™è¾¹æä¾›Transformeræ¨¡å‹å°±å·²ç»å¤Ÿäº†ï¼Œå…·ä½“çš„è®­ç»ƒã€ä¼˜åŒ–ï¼Œåº”è¯¥äº¤ç»™pytorchäº†å§ã€‚ä½†é‰´äºTransformerè®­ç»ƒæ—¶ï¼Œæœ€å¸¸ç”¨çš„ä¼˜åŒ–å™¨å°±æ˜¯AdamWï¼Œè¿™é‡ŒHuggingfaceä¹Ÿç›´æ¥åœ¨"),a("code",[s._v("transformers")]),s._v("åº“ä¸­åŠ å…¥äº†"),a("code",[s._v("AdamW")]),s._v("è¿™ä¸ªä¼˜åŒ–å™¨ï¼Œè¿˜è´´å¿ƒåœ°é…å¤‡äº†lr_schedulerï¼Œæ–¹ä¾¿æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ã€‚")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" transformers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" AdamW"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" get_scheduler\n\noptimizer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" AdamW"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parameters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" lr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5e")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nnum_epochs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nnum_training_steps "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" num_epochs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("len")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("train_dataloader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# num of batches * num of epochs")]),s._v("\nlr_scheduler "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get_scheduler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'linear'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    optimizer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("optimizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scheduleræ˜¯é’ˆå¯¹optimizerçš„lrçš„")]),s._v("\n    num_warmup_steps"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    num_training_steps"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("num_training_steps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("num_training_steps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("1377\n")])])]),a("h2",{attrs:{id:"_3-training"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-training"}},[s._v("#")]),s._v(" 3. Training")]),s._v(" "),a("p",[s._v("é¦–å…ˆï¼Œæˆ‘ä»¬è®¾ç½®cuda deviceï¼Œç„¶åæŠŠæ¨¡å‹ç»™ç§»åŠ¨åˆ°cudaä¸Šï¼š")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" torch\n\ndevice "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cuda'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cuda"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("is_available"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cpu'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmodel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"ç¼–å†™pytorch-training-loops"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¼–å†™pytorch-training-loops"}},[s._v("#")]),s._v(" ç¼–å†™pytorch training loops:")]),s._v(" "),a("p",[s._v("è¿™é‡Œä¹Ÿå¾ˆç®€å•ï¼Œæ€è·¯å°±æ˜¯è¿™æ ·ï¼š")]),s._v(" "),a("ol",[a("li",[s._v("foræ¯ä¸€ä¸ªepoch")]),s._v(" "),a("li",[s._v("ä»dataloaderé‡Œå–å‡ºä¸€ä¸ªä¸ªbatch")]),s._v(" "),a("li",[s._v("æŠŠbatchå–‚ç»™modelï¼ˆå…ˆæŠŠbatchéƒ½ç§»åŠ¨åˆ°å¯¹åº”çš„deviceä¸Šï¼‰")]),s._v(" "),a("li",[s._v("æ‹¿å‡ºlossï¼Œè¿›è¡Œåå‘ä¼ æ’­backward")]),s._v(" "),a("li",[s._v("åˆ†åˆ«æŠŠoptimizerå’Œscheduleréƒ½æ›´æ–°ä¸€ä¸ªstep")])]),s._v(" "),a("p",[s._v("æœ€ååˆ«å¿˜äº†æ¯æ¬¡æ›´æ–°éƒ½è¦æ¸…ç©ºgradï¼Œå³å¯¹optimizerè¿›è¡Œzero_grad()æ“ä½œã€‚")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tqdm "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" tqdm\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" epoch "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("num_epochs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" batch "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" tqdm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("train_dataloader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¦åœ¨GPUä¸Šè®­ç»ƒï¼Œéœ€è¦æŠŠæ•°æ®é›†éƒ½ç§»åŠ¨åˆ°GPUä¸Šï¼š")]),s._v("\n        batch "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        loss "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loss\n        loss"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("backward"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        optimizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("step"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        lr_scheduler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("step"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        optimizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("zero_grad"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("459")]),s._v("/459 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("01:5"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("4")]),s._v("<")]),s._v("00:00,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".01it/s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("459")]),s._v("/459 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("01:5"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("5")]),s._v("<")]),s._v("00:00,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".98it/s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("%"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("459")]),s._v("/459 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("01:5"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("5")]),s._v("<")]),s._v("00:00,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".96it/s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_4-evaluation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-evaluation"}},[s._v("#")]),s._v(" 4. Evaluation")]),s._v(" "),a("p",[s._v("è¿™é‡Œè·Ÿtrain loopè¿˜æ˜¯æŒºç±»ä¼¼çš„ï¼Œä¸€äº›ç»†èŠ‚è§æ³¨é‡Šå³å¯ï¼š")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" datasets "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" load_metric\n\nmetric"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" load_metric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"glue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mrpc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmodel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("eval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" batch "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" eval_dataloader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    batch "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("to"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("no_grad"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# evaluationçš„æ—¶å€™ä¸éœ€è¦ç®—æ¢¯åº¦")]),s._v("\n        outputs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    \n    logits "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" outputs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logits\n    predictions "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argmax"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("logits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dim"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”±äºdataloaderæ˜¯æ¯æ¬¡è¾“å‡ºä¸€ä¸ªbatchï¼Œå› æ­¤æˆ‘ä»¬è¦ç­‰ç€æŠŠæ‰€æœ‰batchéƒ½æ·»åŠ è¿›æ¥ï¼Œå†è¿›è¡Œè®¡ç®—")]),s._v("\n    metric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add_batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("predictions"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" references"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("batch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"labels"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmetric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("compute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'accuracy'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.8651960784313726")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'f1'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9050086355785838")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("p",[s._v("è‡³æ­¤ï¼ŒHuggingface Transformeråˆçº§æ•™ç¨‹å°±å®Œç»“æ’’èŠ±äº†ï¼")]),s._v(" "),a("center",[s._v("ğŸŒ¸ğŸŒ¼ãƒ½(Â°â–½Â°)ãƒğŸŒ¸ğŸŒº")]),s._v(" "),a("p",[s._v("æ›´é«˜çº§çš„æ•™ç¨‹ï¼ŒHuggingfaceä¹Ÿè¿˜æ²¡å‡ºğŸ˜‚ï¼Œæ‰€ä»¥å’±ä»¬æ•¬è¯·æœŸå¾…å§ï¼ä¸è¿‡ï¼Œå­¦å®Œäº†è¿™ä¸ªåˆçº§æ•™ç¨‹ï¼Œæˆ‘ä»¬åŸºæœ¬æ˜¯ä¹Ÿå¯ä»¥å¿«ä¹åœ°æ“ä½œå„ç§å„æ ·Transformer-basedæ¨¡å‹è‡ªç”±ç©è€å•¦ï¼")])],1)}),[],!1,null,null,null);t.default=e.exports}}]);