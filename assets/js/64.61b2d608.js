(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{433:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[a("strong",[t._v("ã€ŒHuggingfaceðŸ¤—NLPç¬”è®°ç³»åˆ—-ç¬¬7é›†ã€")]),t._v("\næœ€è¿‘è·Ÿç€Huggingfaceä¸Šçš„NLP tutorialèµ°äº†ä¸€éï¼ŒæƒŠå¹å±…ç„¶æœ‰å¦‚æ­¤å¥½çš„è®²è§£Transformersç³»åˆ—çš„NLPæ•™ç¨‹ï¼ŒäºŽæ˜¯å†³å®šè®°å½•ä¸€ä¸‹å­¦ä¹ çš„è¿‡ç¨‹ï¼Œåˆ†äº«æˆ‘çš„ç¬”è®°ï¼Œå¯ä»¥ç®—æ˜¯å®˜æ–¹æ•™ç¨‹çš„"),a("strong",[t._v("ç²¾ç®€+æ³¨è§£ç‰ˆ")]),t._v("ã€‚ä½†æœ€æŽ¨èçš„ï¼Œè¿˜æ˜¯ç›´æŽ¥è·Ÿç€å®˜æ–¹æ•™ç¨‹æ¥ä¸€éï¼ŒçœŸæ˜¯ä¸€ç§äº«å—ã€‚")])]),t._v(" "),a("ul",[a("li",[t._v("å®˜æ–¹æ•™ç¨‹ç½‘å€ï¼šhttps://huggingface.co/course/chapter1")]),t._v(" "),a("li",[t._v("æœ¬æœŸå†…å®¹å¯¹åº”ç½‘å€ï¼šhttps://huggingface.co/course/chapter3/3?fw=pt")]),t._v(" "),a("li",[t._v("æœ¬ç³»åˆ—ç¬”è®°çš„"),a("strong",[t._v("GitHub")]),t._v("ï¼š https://github.com/beyondguo/Learn_PyTorch/tree/master/HuggingfaceNLP")])]),t._v(" "),a("hr"),t._v(" "),a("h1",{attrs:{id:"ä½¿ç”¨trainer-apiæ¥å¾®è°ƒæ¨¡åž‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨trainer-apiæ¥å¾®è°ƒæ¨¡åž‹"}},[t._v("#")]),t._v(" ä½¿ç”¨Trainer APIæ¥å¾®è°ƒæ¨¡åž‹")]),t._v(" "),a("h2",{attrs:{id:"_1-æ•°æ®é›†å‡†å¤‡å’Œé¢„å¤„ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ•°æ®é›†å‡†å¤‡å’Œé¢„å¤„ç†"}},[t._v("#")]),t._v(" 1. æ•°æ®é›†å‡†å¤‡å’Œé¢„å¤„ç†ï¼š")]),t._v(" "),a("p",[t._v("è¿™éƒ¨åˆ†å°±æ˜¯å›žé¡¾ä¸Šä¸€é›†çš„å†…å®¹ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("é€šè¿‡datasetåŒ…åŠ è½½æ•°æ®é›†")]),t._v(" "),a("li",[t._v("åŠ è½½é¢„è®­ç»ƒæ¨¡åž‹å’Œtokenizer")]),t._v(" "),a("li",[t._v("å®šä¹‰Dataset.mapè¦ä½¿ç”¨çš„é¢„å¤„ç†å‡½æ•°")]),t._v(" "),a("li",[t._v("å®šä¹‰DataCollatoræ¥ç”¨äºŽæž„é€ è®­ç»ƒbatch")])]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" transformers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" AutoTokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" DataCollatorWithPadding\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" datasets\ncheckpoint "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bert-base-cased'")]),t._v("\ntokenizer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AutoTokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from_pretrained"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("checkpoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nraw_datasets "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_dataset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'glue'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mrpc'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tokenize_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sample"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" tokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sample"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sentence1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sample"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sentence2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" truncation"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntokenized_datasets "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" raw_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tokenize_function"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" batched"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndata_collator "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DataCollatorWithPadding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tokenizer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("h2",{attrs:{id:"_2-åŠ è½½æˆ‘ä»¬è¦fine-tuneçš„æ¨¡åž‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-åŠ è½½æˆ‘ä»¬è¦fine-tuneçš„æ¨¡åž‹"}},[t._v("#")]),t._v(" 2. åŠ è½½æˆ‘ä»¬è¦fine-tuneçš„æ¨¡åž‹ï¼š")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" transformers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" AutoModelForSequenceClassification\nmodel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AutoModelForSequenceClassification"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from_pretrained"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("checkpoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_labels"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("warnings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nSome weights of the model checkpoint at bert-base-cased were not used when initializing BertForSequenceClassification: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cls.predictions.bias'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cls.predictions.transform.dense.weight'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cls.predictions.transform.dense.bias'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cls.predictions.decoder.weight'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cls.seq_relationship.weight'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cls.seq_relationship.bias'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cls.predictions.transform.LayerNorm.weight'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cls.predictions.transform.LayerNorm.bias'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n- This IS expected "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" you are initializing BertForSequenceClassification from the checkpoint of a model trained on another task or with another architecture "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\n- This IS NOT expected "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" you are initializing BertForSequenceClassification from the checkpoint of a model that you "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),t._v(" to be exactly identical "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("initializing a BertForSequenceClassification model from a BertForSequenceClassification model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\nSome weights of BertForSequenceClassification were not initialized from the model checkpoint at bert-base-cased and are newly initialized: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'classifier.weight'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'classifier.bias'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nYou should probably TRAIN this model on a down-stream task to be able to use it "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" predictions and inference.\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("ä¸å¾—ä¸è¯´ï¼Œè¿™ä¸ªHuggingfaceå¾ˆè´´å¿ƒï¼Œè¿™é‡Œçš„warningå†™çš„å¾ˆæ¸…æ¥šã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å¸¦"),a("code",[t._v("ForSequenceClassification")]),t._v("è¿™ä¸ªHeadçš„æ¨¡åž‹ï¼Œä½†æ˜¯æˆ‘ä»¬çš„"),a("code",[t._v("bert-baed-cased")]),t._v("è™½ç„¶å®ƒæœ¬èº«ä¹Ÿæœ‰è‡ªèº«çš„Headï¼Œä½†è·Ÿæˆ‘ä»¬è¿™é‡Œçš„äºŒåˆ†ç±»ä»»åŠ¡ä¸åŒ¹é…ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°ï¼Œå®ƒçš„Headè¢«ç§»é™¤äº†ï¼Œä½¿ç”¨äº†ä¸€ä¸ªéšæœºåˆå§‹åŒ–çš„"),a("code",[t._v("ForSequenceClassification")]),t._v("Headã€‚")]),t._v(" "),a("p",[t._v('æ‰€ä»¥è¿™é‡Œæç¤ºè¿˜è¯´ï¼š"You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference."')]),t._v(" "),a("h2",{attrs:{id:"_3-ä½¿ç”¨traineræ¥è®­ç»ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä½¿ç”¨traineræ¥è®­ç»ƒ"}},[t._v("#")]),t._v(" 3. ä½¿ç”¨"),a("code",[t._v("Trainer")]),t._v("æ¥è®­ç»ƒ")]),t._v(" "),a("p",[a("code",[t._v("Trainer")]),t._v("æ˜¯Huggingface transformersåº“çš„ä¸€ä¸ªé«˜çº§APIï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»ºè®­ç»ƒæ¡†æž¶ï¼š")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" transformers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Trainer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TrainingArguments\n\ntraining_args "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TrainingArguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("output_dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test_trainer'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æŒ‡å®šè¾“å‡ºæ–‡ä»¶å¤¹ï¼Œæ²¡æœ‰ä¼šè‡ªåŠ¨åˆ›å»º")]),t._v("\n\ntrainer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Trainer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    training_args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    train_dataset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"train"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    eval_dataset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"validation"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data_collator"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("data_collator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# åœ¨å®šä¹‰äº†tokenizerä¹‹åŽï¼Œå…¶å®žè¿™é‡Œçš„data_collatorå°±ä¸ç”¨å†å†™äº†ï¼Œä¼šè‡ªåŠ¨æ ¹æ®tokenizeråˆ›å»º")]),t._v("\n    tokenizer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[t._v("æˆ‘ä»¬çœ‹çœ‹"),a("code",[t._v("TrainingArguments")]),t._v("å’Œ"),a("code",[t._v("Trainer")]),t._v("çš„å‚æ•°éƒ½æœ‰äº›å•¥ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("https://huggingface.co/transformers/master/main_classes/trainer.html")]),t._v(" "),a("li",[t._v("https://huggingface.co/transformers/master/main_classes/trainer.html#trainingarguments")])]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("TrainingArguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    output_dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoneType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    overwrite_output_dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    do_train"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    do_eval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    do_predict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    evaluation_strategy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" transformers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("trainer_utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EvaluationStrategy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    prediction_loss_only"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    per_device_train_batch_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# é»˜è®¤çš„batch_size=8")]),t._v("\n    per_device_eval_batch_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    per_gpu_train_batch_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoneType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    per_gpu_eval_batch_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoneType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    gradient_accumulation_steps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    eval_accumulation_steps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoneType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    learning_rate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5e")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("05")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    weight_decay"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    adam_beta1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    adam_beta2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.999")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    adam_epsilon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1e")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("08")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    max_grad_norm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    num_train_epochs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# é»˜è®¤è·‘3è½®")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("Trainer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("transformers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("modeling_utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PreTrainedModel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" transformers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("training_args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TrainingArguments "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data_collator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("DataCollator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoneType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    train_dataset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dataset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Dataset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoneType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    eval_dataset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dataset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Dataset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoneType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    tokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ForwardRef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PreTrainedTokenizerBase'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoneType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    model_init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Callable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" transformers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("modeling_utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PreTrainedModel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    compute_metrics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Callable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("transformers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("trainer_utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EvalPrediction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Dict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoneType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    callbacks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Union"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("List"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("transformers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("trainer_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TrainerCallback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NoneType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    optimizers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Tuple"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("optim"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("optimizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Optimizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" torch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("optim"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lr_scheduler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LambdaLR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# é»˜è®¤ä¼šä½¿ç”¨AdamW")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nDocstring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("     \nTrainer "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" a simple but feature"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("complete training "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("eval")]),t._v(" loop "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" PyTorch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" optimized "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" ðŸ¤— Transformers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[t._v("å¯è§ï¼Œè¿™ä¸ª"),a("code",[t._v("Trainer")]),t._v("æŠŠæ‰€æœ‰è®­ç»ƒä¸­éœ€è¦è€ƒè™‘çš„å‚æ•°ã€è®¾è®¡éƒ½åŒ…æ‹¬åœ¨å†…äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡ŒæŒ‡å®šè®­ç»ƒéªŒè¯é›†ã€data_collatorã€metricsã€optimizerï¼Œå¹¶é€šè¿‡"),a("code",[t._v("TrainingArguments")]),t._v("æ¥æä¾›å„ç§è¶…å‚æ•°ã€‚")]),t._v(" "),a("p",[t._v("é»˜è®¤æƒ…å†µä¸‹ï¼Œ"),a("code",[t._v("Trainer")]),t._v("å’Œ"),a("code",[t._v("TrainingArguments")]),t._v("ä¼šä½¿ç”¨ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("batch size=8")]),t._v(" "),a("li",[t._v("epochs = 3")]),t._v(" "),a("li",[t._v("AdamWä¼˜åŒ–å™¨")])]),t._v(" "),a("p",[t._v("å®šä¹‰å¥½ä¹‹åŽï¼Œç›´æŽ¥ä½¿ç”¨"),a("code",[t._v(".train()")]),t._v("æ¥å¯åŠ¨è®­ç»ƒï¼š")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("trainer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("train"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("è¾“å‡ºï¼š")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/beyond_guo/typora_pics/raw/master/typora/20210927151316.png",alt:"image-20210927151316532"}})]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("TrainOutput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("global_step"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1377")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("training_loss")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.35569445984728887")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("metrics")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'train_runtime'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("383.0158")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'train_samples_per_second'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.595")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'total_flos'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("530185443455520")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'epoch'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("ç„¶åŽæˆ‘ä»¬ç”¨"),a("code",[t._v("Trainer")]),t._v("æ¥é¢„æµ‹ï¼š")]),t._v(" "),a("p",[a("code",[t._v("trainer.predict()")]),t._v("å‡½æ•°å¤„ç†çš„ç»“æžœæ˜¯ä¸€ä¸ª"),a("code",[t._v("named_tuple")]),t._v("ï¼ˆä¸€ç§å¯ä»¥ç›´æŽ¥é€šè¿‡keyæ¥å–å€¼çš„tupleï¼‰ï¼Œç±»ä¼¼ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«ä¸‰ä¸ªå±žæ€§ï¼špredictions, label_ids, metrics")]),t._v(" "),a("p",[t._v("æ³¨æ„ï¼Œè¿™é‡Œçš„ä¸‰ä¸ªå±žæ€§ï¼š")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("predictions")]),t._v("å®žé™…ä¸Šå°±æ˜¯logits")]),t._v(" "),a("li",[a("code",[t._v("label_ids")]),t._v("ä¸æ˜¯é¢„æµ‹å‡ºæ¥çš„idï¼Œè€Œæ˜¯æ•°æ®é›†ä¸­è‡ªå¸¦çš„ground truthçš„æ ‡ç­¾ï¼Œå› æ­¤å¦‚æžœè¾“å…¥çš„æ•°æ®é›†ä¸­æ²¡ç»™æ ‡ç­¾ï¼Œè¿™é‡Œä¹Ÿä¸ä¼šè¾“å‡º")]),t._v(" "),a("li",[a("code",[t._v("metrics")]),t._v("ï¼Œä¹Ÿæ˜¯åªæœ‰è¾“å…¥çš„æ•°æ®é›†ä¸­æä¾›äº†"),a("code",[t._v("label_ids")]),t._v("æ‰ä¼šè¾“å‡ºmetricsï¼ŒåŒ…æ‹¬lossä¹‹ç±»çš„æŒ‡æ ‡")])]),t._v(" "),a("p",[t._v("å…¶ä¸­"),a("code",[t._v("metrics")]),t._v("ä¸­è¿˜å¯ä»¥åŒ…å«æˆ‘ä»¬è‡ªå®šä¹‰çš„å­—æ®µï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®šä¹‰"),a("code",[t._v("Trainer")]),t._v("çš„æ—¶å€™ç»™å®š"),a("code",[t._v("compute_metrics")]),t._v("å‚æ•°ã€‚")]),t._v(" "),a("p",[t._v("æ–‡æ¡£å‚è€ƒï¼š https://huggingface.co/transformers/master/main_classes/trainer.html#transformers.Trainer.predict")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("predictions "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" trainer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("predict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'validation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shape"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# logits")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# array([[-2.7887206,  3.1986978],")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#       [ 2.5258656, -1.832253 ], ...], dtype=float32)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("label_ids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shape"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# array([1, 0, 0, 1, 0, 1, 0, 1, 1, 1, ...], dtype=int64)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("metrics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("è¾“å‡ºï¼š")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v("/51 00:03"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("408")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("408")]),t._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eval_loss'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.7387174963951111")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eval_runtime'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.2872")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eval_samples_per_second'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("124.117")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("ç„¶åŽå°±å¯ä»¥ç”¨predså’Œlabelsæ¥è®¡ç®—ä¸€äº›ç›¸å…³çš„metricsäº†ã€‚")]),t._v(" "),a("p",[t._v("Huggingface "),a("code",[t._v("datasets")]),t._v("é‡Œé¢å¯ä»¥ç›´æŽ¥å¯¼å…¥è·Ÿæ•°æ®é›†ç›¸å…³çš„metricsï¼š")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" datasets "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" load_metric\n\npreds "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argmax"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" axis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmetric "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" load_metric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'glue'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mrpc'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmetric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("preds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" references"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("label_ids"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accuracy'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8455882352941176")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'f1'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8911917098445595")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("çœ‹çœ‹è¿™é‡Œçš„metricï¼ˆglue typeï¼‰çš„æ–‡æ¡£ï¼š")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("Args:\n    predictions: list of predictions to score.\n        Each translation should be tokenized into a list of tokens.\n    references: list of lists of references "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" each translation.\n        Each reference should be tokenized into a list of tokens.\nReturns: depending on the GLUE subset, one or several of:\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accuracy"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" Accuracy\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"f1"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" F1 score\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pearson"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" Pearson Correlation\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"spearmanr"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" Spearman Correlation\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"matthews_correlation"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" Matthew Correlation\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h2",{attrs:{id:"_4-æž„å»ºtrainerä¸­çš„compute-metricså‡½æ•°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-æž„å»ºtrainerä¸­çš„compute-metricså‡½æ•°"}},[t._v("#")]),t._v(" 4.æž„å»º"),a("code",[t._v("Trainer")]),t._v("ä¸­çš„"),a("code",[t._v("compute_metrics")]),t._v("å‡½æ•°")]),t._v(" "),a("p",[t._v("å‰é¢æˆ‘ä»¬æ³¨æ„åˆ°"),a("code",[t._v("Trainer")]),t._v("çš„å‚æ•°ä¸­ï¼Œå¯ä»¥æä¾›ä¸€ä¸ª"),a("code",[t._v("compute_metrics")]),t._v("å‡½æ•°ï¼Œç”¨äºŽè¾“å‡ºæˆ‘ä»¬å¸Œæœ›æœ‰çš„ä¸€äº›æŒ‡æ ‡ã€‚")]),t._v(" "),a("p",[t._v("è¿™ä¸ª"),a("code",[t._v("compute_metrics")]),t._v("æœ‰ä¸€äº›è¾“å…¥è¾“å‡ºçš„è¦æ±‚ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("è¾“å…¥ï¼šæ˜¯ä¸€ä¸ª"),a("code",[t._v("EvalPrediction")]),t._v("å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªnamed tupleï¼Œéœ€è¦æœ‰è‡³å°‘"),a("code",[t._v("predictions")]),t._v("å’Œ"),a("code",[t._v("label_ids")]),t._v("ä¸¤ä¸ªå­—æ®µï¼›ç»è¿‡æŸ¥çœ‹æºç ï¼Œè¿™é‡Œçš„predictionsï¼Œ"),a("strong",[t._v("å°±æ˜¯logits")])]),t._v(" "),a("li",[t._v("è¾“å‡ºï¼šä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«å„ä¸ªmetricså’Œå¯¹åº”çš„æ•°å€¼ã€‚")])]),t._v(" "),a("p",[t._v("æºç åœ°å€ï¼š https://huggingface.co/transformers/master/_modules/transformers/trainer.html#Trainer")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" datasets "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" load_metric\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("compute_metrics")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eval_preds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    metric "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" load_metric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"glue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mrpc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    logits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" labels "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" eval_preds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eval_preds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("label_ids\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¸Šä¸€è¡Œå¯ä»¥ç›´æŽ¥ç®€å†™æˆï¼š")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# logits, labels = eval_preds  å› ä¸ºå®ƒç›¸å½“äºŽä¸€ä¸ªtuple")]),t._v("\n    predictions "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argmax"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("logits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" axis"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" metric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("predictions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" references"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("labels"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h3",{attrs:{id:"æ€»ç»“ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹"}},[t._v("#")]),t._v(" æ€»ç»“ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("é¦–å…ˆæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª"),a("code",[t._v("compute_metrics")]),t._v("å‡½æ•°ï¼Œäº¤ç»™"),a("code",[t._v("Trainer")]),t._v("ï¼›")]),t._v(" "),a("li",[a("code",[t._v("Trainer")]),t._v("è®­ç»ƒæ¨¡åž‹ï¼Œæ¨¡åž‹ä¼šå¯¹æ ·æœ¬è®¡ç®—ï¼Œäº§ç”Ÿ predictions (logits)ï¼›")]),t._v(" "),a("li",[a("code",[t._v("Trainer")]),t._v("å†æŠŠ predictions å’Œæ•°æ®é›†ä¸­ç»™å®šçš„ label_ids æ‰“åŒ…æˆä¸€ä¸ªå¯¹è±¡ï¼Œå‘é€ç»™"),a("code",[t._v("compute_metrics")]),t._v("å‡½æ•°ï¼›")]),t._v(" "),a("li",[a("code",[t._v("compute_metrics")]),t._v("å‡½æ•°è®¡ç®—å¥½ç›¸åº”çš„ metrics ç„¶åŽè¿”å›žã€‚")])]),t._v(" "),a("h2",{attrs:{id:"çœ‹çœ‹å¸¦ä¸Šäº†-compute-metrics-ä¹‹åŽçš„è®­ç»ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#çœ‹çœ‹å¸¦ä¸Šäº†-compute-metrics-ä¹‹åŽçš„è®­ç»ƒ"}},[t._v("#")]),t._v(" çœ‹çœ‹å¸¦ä¸Šäº† compute_metrics ä¹‹åŽçš„è®­ç»ƒï¼š")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("training_args "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TrainingArguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("output_dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test_trainer'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" evaluation_strategy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'epoch'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmodel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AutoModelForSequenceClassification"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from_pretrained"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("checkpoint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_labels"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# new model")]),t._v("\ntrainer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Trainer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    training_args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    train_dataset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"train"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    eval_dataset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tokenized_datasets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"validation"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data_collator"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("data_collator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# åœ¨å®šä¹‰äº†tokenizerä¹‹åŽï¼Œå…¶å®žè¿™é‡Œçš„data_collatorå°±ä¸ç”¨å†å†™äº†ï¼Œä¼šè‡ªåŠ¨æ ¹æ®tokenizeråˆ›å»º")]),t._v("\n    tokenizer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tokenizer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    compute_metrics"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("compute_metrics\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ntrainer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("train"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("è¾“å‡ºï¼š")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/beyond_guo/typora_pics/raw/master/typora/20210927151222.png",alt:"image-20210927151216236"}})]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("TrainOutput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("global_step"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1377")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("training_loss")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.32063739751678666")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("metrics")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'train_runtime'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("414.1719")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'train_samples_per_second'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.325")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'total_flos'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("530351810395680")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'epoch'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("å¯è§ï¼Œå¸¦ä¸Šäº†"),a("code",[t._v("compute_metircs")]),t._v("å‡½æ•°ä¹‹åŽï¼Œåœ¨Trainerè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¼šæŠŠå¢žåŠ çš„metricä¹Ÿæ‰“å°å‡ºæ¥ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ—¶åˆ»äº†è§£è®­ç»ƒçš„è¿›å±•ã€‚")])])}),[],!1,null,null,null);s.default=e.exports}}]);