<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MoE (Mixture-of-Experts) ç»å…¸æ–‡ç« ç®€è¯» | éƒ­å¿…æ‰¬çš„å†™å­—æ¥¼</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-alpha/dist/katex.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/logo_no_words.png">
    <script>
    var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5aca48f844181444aea941eb9d707584";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
    </script>
    <meta name="description" content="æ¬¢è¿å…‰ä¸´å†™å­—æ¥¼ï¼Œå¤§æ¥¼å°šåœ¨æ–½å·¥ä¸­ğŸš§ï¼Œå¯¹æ‚¨é€ æˆçš„ä¸ä¾¿è¯·æ‚¨è°…è§£">
    
    <link rel="preload" href="/assets/css/0.styles.29dce6f0.css" as="style"><link rel="preload" href="/assets/js/app.41fc4255.js" as="script"><link rel="preload" href="/assets/js/2.a266bdc2.js" as="script"><link rel="preload" href="/assets/js/84.f2c12c65.js" as="script"><link rel="prefetch" href="/assets/js/10.4ee4705c.js"><link rel="prefetch" href="/assets/js/100.29306973.js"><link rel="prefetch" href="/assets/js/101.b7851f01.js"><link rel="prefetch" href="/assets/js/102.969e84bd.js"><link rel="prefetch" href="/assets/js/103.a356b143.js"><link rel="prefetch" href="/assets/js/104.51024b34.js"><link rel="prefetch" href="/assets/js/105.43f26204.js"><link rel="prefetch" href="/assets/js/106.c52df18d.js"><link rel="prefetch" href="/assets/js/107.856c79a2.js"><link rel="prefetch" href="/assets/js/108.bfb45b71.js"><link rel="prefetch" href="/assets/js/11.e2907ec5.js"><link rel="prefetch" href="/assets/js/12.65ea25ed.js"><link rel="prefetch" href="/assets/js/13.cbd5d07c.js"><link rel="prefetch" href="/assets/js/14.b84744eb.js"><link rel="prefetch" href="/assets/js/15.aadcc6a8.js"><link rel="prefetch" href="/assets/js/16.db45b326.js"><link rel="prefetch" href="/assets/js/17.7b58bd1b.js"><link rel="prefetch" href="/assets/js/18.38d69ee8.js"><link rel="prefetch" href="/assets/js/19.4e5ae4a8.js"><link rel="prefetch" href="/assets/js/20.7095c920.js"><link rel="prefetch" href="/assets/js/21.242fa291.js"><link rel="prefetch" href="/assets/js/22.5d8fafb1.js"><link rel="prefetch" href="/assets/js/23.7ce40eb4.js"><link rel="prefetch" href="/assets/js/24.18bba9ed.js"><link rel="prefetch" href="/assets/js/25.5d7dc814.js"><link rel="prefetch" href="/assets/js/26.a658bfa8.js"><link rel="prefetch" href="/assets/js/27.67a75243.js"><link rel="prefetch" href="/assets/js/28.f618d912.js"><link rel="prefetch" href="/assets/js/29.cebd6470.js"><link rel="prefetch" href="/assets/js/3.56cdaf41.js"><link rel="prefetch" href="/assets/js/30.8b95a1f1.js"><link rel="prefetch" href="/assets/js/31.c91ff346.js"><link rel="prefetch" href="/assets/js/32.b98ca641.js"><link rel="prefetch" href="/assets/js/33.d0d05ad0.js"><link rel="prefetch" href="/assets/js/34.4c521488.js"><link rel="prefetch" href="/assets/js/35.b804bcd7.js"><link rel="prefetch" href="/assets/js/36.5c07cfef.js"><link rel="prefetch" href="/assets/js/37.a0565011.js"><link rel="prefetch" href="/assets/js/38.b8ae16d0.js"><link rel="prefetch" href="/assets/js/39.ac23927e.js"><link rel="prefetch" href="/assets/js/4.b9abaf2a.js"><link rel="prefetch" href="/assets/js/40.51f0a3f5.js"><link rel="prefetch" href="/assets/js/41.c1a8242a.js"><link rel="prefetch" href="/assets/js/42.749efe23.js"><link rel="prefetch" href="/assets/js/43.624833c8.js"><link rel="prefetch" href="/assets/js/44.bbddd63e.js"><link rel="prefetch" href="/assets/js/45.d8d15651.js"><link rel="prefetch" href="/assets/js/46.1e480f1b.js"><link rel="prefetch" href="/assets/js/47.4f1075d4.js"><link rel="prefetch" href="/assets/js/48.a8f6c2ba.js"><link rel="prefetch" href="/assets/js/49.106d8698.js"><link rel="prefetch" href="/assets/js/5.1c0b46f4.js"><link rel="prefetch" href="/assets/js/50.a0819973.js"><link rel="prefetch" href="/assets/js/51.cb93eaba.js"><link rel="prefetch" href="/assets/js/52.69fe7f19.js"><link rel="prefetch" href="/assets/js/53.ad8f6842.js"><link rel="prefetch" href="/assets/js/54.c25909c5.js"><link rel="prefetch" href="/assets/js/55.833154c7.js"><link rel="prefetch" href="/assets/js/56.75e06106.js"><link rel="prefetch" href="/assets/js/57.f5b5d514.js"><link rel="prefetch" href="/assets/js/58.574fd406.js"><link rel="prefetch" href="/assets/js/59.d07a17b6.js"><link rel="prefetch" href="/assets/js/6.4b4de84d.js"><link rel="prefetch" href="/assets/js/60.ee946b2f.js"><link rel="prefetch" href="/assets/js/61.68581797.js"><link rel="prefetch" href="/assets/js/62.99d168fd.js"><link rel="prefetch" href="/assets/js/63.14c4cfa2.js"><link rel="prefetch" href="/assets/js/64.61b2d608.js"><link rel="prefetch" href="/assets/js/65.f7077be9.js"><link rel="prefetch" href="/assets/js/66.0ce2a0ec.js"><link rel="prefetch" href="/assets/js/67.ee0094b6.js"><link rel="prefetch" href="/assets/js/68.c61d0f9f.js"><link rel="prefetch" href="/assets/js/69.c59f3168.js"><link rel="prefetch" href="/assets/js/7.ea2aa07c.js"><link rel="prefetch" href="/assets/js/70.21ea68bf.js"><link rel="prefetch" href="/assets/js/71.11355b09.js"><link rel="prefetch" href="/assets/js/72.cdc4bc45.js"><link rel="prefetch" href="/assets/js/73.d8946aed.js"><link rel="prefetch" href="/assets/js/74.75a2fd5c.js"><link rel="prefetch" href="/assets/js/75.14d3ef7d.js"><link rel="prefetch" href="/assets/js/76.3f73a91e.js"><link rel="prefetch" href="/assets/js/77.0018ed7f.js"><link rel="prefetch" href="/assets/js/78.c471326e.js"><link rel="prefetch" href="/assets/js/79.f9a1e6f0.js"><link rel="prefetch" href="/assets/js/8.f25633c9.js"><link rel="prefetch" href="/assets/js/80.a8c296e0.js"><link rel="prefetch" href="/assets/js/81.f6451a8b.js"><link rel="prefetch" href="/assets/js/82.f7393e31.js"><link rel="prefetch" href="/assets/js/83.a0642cbd.js"><link rel="prefetch" href="/assets/js/85.f0077176.js"><link rel="prefetch" href="/assets/js/86.4180d39a.js"><link rel="prefetch" href="/assets/js/87.04e4ab18.js"><link rel="prefetch" href="/assets/js/88.93ea241c.js"><link rel="prefetch" href="/assets/js/89.555a3ba8.js"><link rel="prefetch" href="/assets/js/9.9aae1341.js"><link rel="prefetch" href="/assets/js/90.0701a493.js"><link rel="prefetch" href="/assets/js/91.8347eb90.js"><link rel="prefetch" href="/assets/js/92.9320e5ec.js"><link rel="prefetch" href="/assets/js/93.87dec14c.js"><link rel="prefetch" href="/assets/js/94.7a4ce357.js"><link rel="prefetch" href="/assets/js/95.060612ac.js"><link rel="prefetch" href="/assets/js/96.0b640400.js"><link rel="prefetch" href="/assets/js/97.5572d4ae.js"><link rel="prefetch" href="/assets/js/98.e013c8af.js"><link rel="prefetch" href="/assets/js/99.867ed389.js">
    <link rel="stylesheet" href="/assets/css/0.styles.29dce6f0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo_no_words.png" alt="éƒ­å¿…æ‰¬çš„å†™å­—æ¥¼" class="logo"> <span class="site-name can-hide">éƒ­å¿…æ‰¬çš„å†™å­—æ¥¼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/dl_basis/" class="nav-link">
  æ·±åº¦å­¦ä¹ ç¬”è®°
</a></div><div class="nav-item"><a href="/nlp_basis/" class="nav-link">
  NLPç¬”è®°
</a></div><div class="nav-item"><a href="/paper_notes/" class="nav-link router-link-active">
  åƒç‚¹å„¿è®ºæ–‡
</a></div><div class="nav-item"><a href="/engineering/" class="nav-link">
  å·¥ç¨‹
</a></div><div class="nav-item"><a href="/opinions/" class="nav-link">
  éšç¬”
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  Me
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åœ¨åˆ«å¤„~" class="dropdown-title"><span class="title">åœ¨åˆ«å¤„~</span> <span class="arrow down"></span></button> <button type="button" aria-label="åœ¨åˆ«å¤„~" class="mobile-dropdown-title"><span class="title">åœ¨åˆ«å¤„~</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/beyondguo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://mp.weixin.qq.com/s/v35g-p7wK2MkuM-SqjkF3g" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¾®ä¿¡å…¬ä¼—å·ã€ŒSimpleAIã€
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zhihu.com/people/guo-bi-yang-78" target="_blank" rel="noopener noreferrer" class="nav-link external">
  çŸ¥ä¹ã€Œèˆèˆã€
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/f4fe92da869c" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ç®€ä¹¦
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/dl_basis/" class="nav-link">
  æ·±åº¦å­¦ä¹ ç¬”è®°
</a></div><div class="nav-item"><a href="/nlp_basis/" class="nav-link">
  NLPç¬”è®°
</a></div><div class="nav-item"><a href="/paper_notes/" class="nav-link router-link-active">
  åƒç‚¹å„¿è®ºæ–‡
</a></div><div class="nav-item"><a href="/engineering/" class="nav-link">
  å·¥ç¨‹
</a></div><div class="nav-item"><a href="/opinions/" class="nav-link">
  éšç¬”
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  Me
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åœ¨åˆ«å¤„~" class="dropdown-title"><span class="title">åœ¨åˆ«å¤„~</span> <span class="arrow down"></span></button> <button type="button" aria-label="åœ¨åˆ«å¤„~" class="mobile-dropdown-title"><span class="title">åœ¨åˆ«å¤„~</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/beyondguo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://mp.weixin.qq.com/s/v35g-p7wK2MkuM-SqjkF3g" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å¾®ä¿¡å…¬ä¼—å·ã€ŒSimpleAIã€
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zhihu.com/people/guo-bi-yang-78" target="_blank" rel="noopener noreferrer" class="nav-link external">
  çŸ¥ä¹ã€Œèˆèˆã€
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.jianshu.com/u/f4fe92da869c" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ç®€ä¹¦
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MoE (Mixture-of-Experts) ç»å…¸æ–‡ç« ç®€è¯»</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#å¼€åˆ›å·¥ä½œ" class="sidebar-link">å¼€åˆ›å·¥ä½œ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#_1-adaptive-mixtures-of-local-experts-neural-computation-1991" class="sidebar-link">1. Adaptive mixtures of local experts, Neural Computation'1991</a></li><li class="sidebar-sub-header"><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#_2-outrageously-large-neural-networks-the-sparsely-gated-mixture-of-experts-layer-iclr-17" class="sidebar-link">2. Outrageously Large Neural Networks: The Sparsely-Gated Mixture-of-Experts Layer, ICLR'17</a></li></ul></li><li><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#ä½¿ç”¨-moe-å¼€å‘è¶…å¤§æ¨¡å‹" class="sidebar-link">ä½¿ç”¨ MoE å¼€å‘è¶…å¤§æ¨¡å‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#_3-gshard-scaling-giant-models-with-conditional-computation-and-automatic-sharding-iclr-21" class="sidebar-link">3. GShard: Scaling Giant Models with Conditional Computation and Automatic Sharding, ICLR'21</a></li><li class="sidebar-sub-header"><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#_4-switch-transformers-scaling-to-trillion-parameter-models-with-simple-and-efficient-sparsity-jmlr-22" class="sidebar-link">4. Switch Transformers: Scaling to Trillion Parameter Models with Simple and Efficient Sparsity, JMLR'22</a></li><li class="sidebar-sub-header"><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#_5-glam-efficient-scaling-of-language-models-with-mixture-of-experts-2021" class="sidebar-link">5. GLaM: Efficient Scaling of Language Models with Mixture-of-Experts, 2021</a></li></ul></li><li><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#ä½¿ç”¨-moe-æ¥ä½¿æ¨¡å‹è½»é‡åŒ–" class="sidebar-link">ä½¿ç”¨ MoE æ¥ä½¿æ¨¡å‹è½»é‡åŒ–</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#_6-go-wider-instead-of-deeper-aaai-22" class="sidebar-link">6. Go Wider Instead of Deeper, AAAI'22</a></li><li class="sidebar-sub-header"><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#_7-moebert-from-bert-to-mixture-of-experts-via-importance-guided-adaptation-naacl-22" class="sidebar-link">7. MoEBERT: from BERT to Mixture-of-Experts via Importance-Guided Adaptation, NAACL'22</a></li></ul></li><li><a href="/paper_notes/notes/MoE%E2%80%94%E2%80%94Mixture%20of%20Experts%E7%BB%8F%E5%85%B8%E8%AE%BA%E6%96%87%E4%B8%80%E8%A7%88.html#ç»“è¯­" class="sidebar-link">ç»“è¯­ï¼š</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mixture-of-experts-moe-ç»å…¸è®ºæ–‡ä¸€è§ˆ"><a href="#mixture-of-experts-moe-ç»å…¸è®ºæ–‡ä¸€è§ˆ" class="header-anchor">#</a> Mixture-of-Experts (MoE) ç»å…¸è®ºæ–‡ä¸€è§ˆ</h1> <p>æœ€è¿‘æ¥è§¦åˆ° <strong>Mixture-of-Experts (MoE)</strong> è¿™ä¸ªæ¦‚å¿µï¼Œæ‰å‘ç°è¿™æ˜¯ä¸€ä¸ªå·²ç»æœ‰30å¤šå¹´å†å²ã€è‡³ä»Šä¾ç„¶åœ¨è¢«å¹¿æ³›åº”ç”¨çš„æŠ€æœ¯ï¼Œæ‰€ä»¥è¯»äº†ç›¸å…³çš„å‡ ç¯‡ç»å…¸è®ºæ–‡ï¼Œåœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚</p> <h2 id="å¼€åˆ›å·¥ä½œ"><a href="#å¼€åˆ›å·¥ä½œ" class="header-anchor">#</a> å¼€åˆ›å·¥ä½œ</h2> <h3 id="_1-adaptive-mixtures-of-local-experts-neural-computation-1991"><a href="#_1-adaptive-mixtures-of-local-experts-neural-computation-1991" class="header-anchor">#</a> 1. Adaptive mixtures of local experts, Neural Computation'1991</h3> <ul><li>æœŸåˆŠ/ä¼šè®®ï¼šNeural Computation (1991)</li> <li>è®ºæ–‡é“¾æ¥ï¼šhttps://readpaper.com/paper/2150884987</li> <li>ä»£è¡¨æ€§ä½œè€…ï¼šMichael Jordan, Geoffrey Hinton</li></ul> <p>è¿™æ˜¯å¤§å¤šæ•°MoEè®ºæ–‡éƒ½å¼•ç”¨çš„æœ€æ—©çš„ä¸€ç¯‡æ–‡ç« ï¼Œå‘è¡¨äº1991å¹´ï¼Œä½œè€…ä¸­æœ‰ä¸¤ä¸ªå¤§å®¶ç†ŸçŸ¥çš„å¤§ä½¬ï¼šMichael Jordan å’Œ Geoffrey Hintonã€‚è™½ç„¶æ˜¯30å¹´å‰çš„è®ºæ–‡ï¼Œä½†æ˜¯è¯»èµ·æ¥è¿˜æ˜¯å¾ˆæµç•…ï¼Œæ²¡æœ‰ä»€ä¹ˆâ€œè·ç¦»æ„Ÿâ€ï¼Œå»ºè®®è¯»ä¸€è¯»ã€‚</p> <p><strong>Main Ideaï¼š</strong></p> <p>æå‡ºäº†ä¸€ç§æ–°çš„ç›‘ç£å­¦ä¹ è¿‡ç¨‹ï¼Œä¸€ä¸ªç³»ç»Ÿä¸­åŒ…å«å¤šä¸ªåˆ†å¼€çš„ç½‘ç»œï¼Œæ¯ä¸ªç½‘ç»œå»å¤„ç†å…¨éƒ¨è®­ç»ƒæ ·æœ¬çš„ä¸€ä¸ªå­é›†ã€‚è¿™ç§æ–¹å¼å¯ä»¥çœ‹åšæ˜¯æŠŠå¤šå±‚ç½‘ç»œè¿›è¡Œäº†æ¨¡å—åŒ–çš„è½¬æ¢ã€‚</p> <p>å‡è®¾æˆ‘ä»¬å·²ç»çŸ¥é“æ•°æ®é›†ä¸­å­˜åœ¨ä¸€äº›å¤©ç„¶çš„å­é›†ï¼ˆæ¯”å¦‚æ¥è‡ªä¸åŒçš„domainï¼Œä¸åŒçš„topicï¼‰ï¼Œé‚£ä¹ˆç”¨å•ä¸ªæ¨¡å‹å»å­¦ä¹ ï¼Œå°±ä¼šå—åˆ°å¾ˆå¤šå¹²æ‰°ï¼ˆinterferenceï¼‰ï¼Œå¯¼è‡´å­¦ä¹ å¾ˆæ…¢ã€æ³›åŒ–å›°éš¾ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªæ¨¡å‹ï¼ˆå³ä¸“å®¶ï¼Œexpertï¼‰å»å­¦ä¹ ï¼Œä½¿ç”¨ä¸€ä¸ªé—¨ç½‘ç»œï¼ˆgating networkï¼‰æ¥å†³å®šæ¯ä¸ªæ•°æ®åº”è¯¥è¢«å“ªä¸ªæ¨¡å‹å»è®­ç»ƒï¼Œè¿™æ ·å°±å¯ä»¥å‡è½»ä¸åŒç±»å‹æ ·æœ¬ä¹‹é—´çš„å¹²æ‰°ã€‚</p> <p>å…¶å®è¿™ç§åšæ³•ï¼Œä¹Ÿä¸æ˜¯è¯¥è®ºæ–‡ç¬¬ä¸€æ¬¡æå‡ºçš„ï¼Œæ›´æ—©å°±æœ‰äººæå‡ºè¿‡ç±»ä¼¼çš„æ–¹æ³•ã€‚å¯¹äºä¸€ä¸ªæ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span>ï¼Œç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ª expert çš„è¾“å‡ºä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant="bold">o</mi><mi>i</mi><mi>c</mi></msubsup></mrow><annotation encoding="application/x-tex">\mathbf{o}_i^c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.923056em;vertical-align:-0.258664em;"></span><span class="mord"><span class="mord mathbf">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œç†æƒ³çš„è¾“å‡ºæ˜¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="bold">d</mi><mi>c</mi></msup></mrow><annotation encoding="application/x-tex">\mathbf{d}^c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbf">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span></span>ï¼Œé‚£ä¹ˆæŸå¤±å‡½æ•°å°±è¿™ä¹ˆè®¡ç®—ï¼š</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>E</mi><mi>c</mi></msup><mo>=</mo><mi mathvariant="normal">âˆ¥</mi><msup><mi mathvariant="bold">d</mi><mi>c</mi></msup><mo>âˆ’</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><msubsup><mi>p</mi><mi>i</mi><mi>c</mi></msubsup><msubsup><mi mathvariant="bold">o</mi><mi>i</mi><mi>c</mi></msubsup><msup><mi mathvariant="normal">âˆ¥</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">E^c = \| \mathbf{d}^c - \sum_ip^c_i\mathbf{o}^c_i \|^2
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.7143919999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ¥</span><span class="mord"><span class="mord mathbf">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">âˆ¥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p> <p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>p</mi><mi>i</mi><mi>c</mi></msubsup></mrow><annotation encoding="application/x-tex">p_i^c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.923056em;vertical-align:-0.258664em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯ gating network åˆ†é…ç»™æ¯ä¸ª expert çš„æƒé‡ï¼Œç›¸å½“äºå¤šä¸ª expert é½å¿ƒååŠ›æ¥å¾—åˆ°å½“å‰æ ·æœ¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span> çš„è¾“å‡ºã€‚</p> <p>è¿™æ˜¯ä¸€ä¸ªå¾ˆè‡ªç„¶çš„è®¾è®¡æ–¹å¼ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜â€”â€”ä¸åŒçš„ expert ä¹‹é—´çš„äº’ç›¸å½±å“ä¼šéå¸¸å¤§ï¼Œä¸€ä¸ªexpertçš„å‚æ•°æ”¹å˜äº†ï¼Œå…¶ä»–çš„éƒ½ä¼šè·Ÿç€æ”¹å˜ï¼Œå³æ‰€è°“ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚è¿™æ ·çš„è®¾è®¡ï¼Œæœ€ç»ˆçš„ç»“æœå°±æ˜¯ä¸€ä¸ªæ ·æœ¬ä¼šä½¿ç”¨å¾ˆå¤šçš„expertæ¥å¤„ç†ã€‚äºæ˜¯ï¼Œè¿™ç¯‡æ–‡ç« è®¾è®¡äº†ä¸€ç§æ–°çš„æ–¹å¼ï¼Œè°ƒæ•´äº†ä¸€ä¸‹lossçš„è®¾è®¡ï¼Œæ¥é¼“åŠ±ä¸åŒçš„expertä¹‹é—´è¿›è¡Œç«äº‰ï¼š</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>E</mi><mi>c</mi></msup><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><msubsup><mi>p</mi><mi>i</mi><mi>c</mi></msubsup><mi mathvariant="normal">âˆ¥</mi><msup><mi mathvariant="bold">d</mi><mi>c</mi></msup><mo>âˆ’</mo><msubsup><mi mathvariant="bold">o</mi><mi>i</mi><mi>c</mi></msubsup><msup><mi mathvariant="normal">âˆ¥</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">E^c = \sum_ip^c_i\| \mathbf{d}^c - \mathbf{o}^c_i \|^2
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.7143919999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord">âˆ¥</span><span class="mord"><span class="mord mathbf">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbf">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">âˆ¥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p> <p>å°±æ˜¯è®©ä¸åŒçš„ expert å•ç‹¬è®¡ç®— lossï¼Œç„¶ååœ¨åŠ æƒæ±‚å’Œå¾—åˆ°æ€»ä½“çš„ lossã€‚è¿™æ ·çš„è¯ï¼Œæ¯ä¸ªä¸“å®¶ï¼Œéƒ½æœ‰ç‹¬ç«‹åˆ¤æ–­çš„èƒ½åŠ›ï¼Œè€Œä¸ç”¨ä¾é å…¶ä»–çš„ expert æ¥ä¸€èµ·å¾—åˆ°é¢„æµ‹ç»“æœã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºæ„å›¾ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161257438.png" alt="image-20220716125715320"></p> <p>åœ¨è¿™ç§è®¾è®¡ä¸‹ï¼Œæˆ‘ä»¬å°† experts å’Œ gating network ä¸€èµ·è¿›è¡Œè®­ç»ƒï¼Œæœ€ç»ˆçš„ç³»ç»Ÿå°±ä¼šå€¾å‘äºè®©ä¸€ä¸ª expert å»å¤„ç†ä¸€ä¸ªæ ·æœ¬ã€‚</p> <p>ä¸Šé¢çš„<strong>ä¸¤ä¸ª loss functionï¼Œå…¶å®é•¿å¾—éå¸¸åƒï¼Œä½†æ˜¯ä¸€ä¸ªæ˜¯é¼“åŠ±åˆä½œï¼Œä¸€ä¸ªæ˜¯é¼“åŠ±ç«äº‰</strong>ã€‚è¿™ä¸€ç‚¹è¿˜æ˜¯æŒºå¯å‘äººçš„ã€‚</p> <p>è®ºæ–‡è¿˜æåˆ°å¦å¤–ä¸€ä¸ªå¾ˆå¯å‘äººçš„ trickï¼Œå°±æ˜¯ä¸Šé¢é‚£ä¸ªæŸå¤±å‡½æ•°ï¼Œä½œè€…åœ¨å®é™…åšå®éªŒçš„æ—¶å€™ï¼Œç”¨äº†ä¸€ä¸ªå˜ä½“ï¼Œä½¿å¾—æ•ˆæœæ›´å¥½ï¼š</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>O</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mo>:</mo><mtext></mtext><msup><mi>E</mi><mi>c</mi></msup><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><msubsup><mi>p</mi><mi>i</mi><mi>c</mi></msubsup><mi mathvariant="normal">âˆ¥</mi><msup><mi mathvariant="bold">d</mi><mi>c</mi></msup><mo>âˆ’</mo><msubsup><mi mathvariant="bold">o</mi><mi>i</mi><mi>c</mi></msubsup><msup><mi mathvariant="normal">âˆ¥</mi><mn>2</mn></msup><mspace linebreak="newline"></mspace><mi>M</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>d</mi><mo>:</mo><mtext></mtext><msup><mi>E</mi><mi>c</mi></msup><mo>=</mo><mo>âˆ’</mo><mi>l</mi><mi>o</mi><mi>g</mi><munder><mo>âˆ‘</mo><mi>i</mi></munder><msubsup><mi>p</mi><mi>i</mi><mi>c</mi></msubsup><msup><mi>e</mi><mrow><mo>âˆ’</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi mathvariant="normal">âˆ¥</mi><msup><mi mathvariant="bold">d</mi><mi>c</mi></msup><mo>âˆ’</mo><msubsup><mi mathvariant="bold">o</mi><mi>i</mi><mi>c</mi></msubsup><msup><mi mathvariant="normal">âˆ¥</mi><mn>2</mn></msup></mrow></msup></mrow><annotation encoding="application/x-tex">Original:\ \ E^c = \sum_ip^c_i\| \mathbf{d}^c - \mathbf{o}^c_i \|^2 \\
Modified:\ \ E^c = -log\sum_ip^c_ie^{-\frac{1}{2}\| \mathbf{d}^c - \mathbf{o}^c_i \|^2}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">ina</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace"></span><span class="mspace"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7143919999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord">âˆ¥</span><span class="mord"><span class="mord mathbf">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathbf">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">âˆ¥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace"></span><span class="mspace"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7143919999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.327674em;vertical-align:-1.277669em;"></span><span class="mord">âˆ’</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0369199999999998em;"><span style="top:-3.4130000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mord mtight">âˆ¥</span><span class="mord mtight"><span class="mord mathbf mtight">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385428571428572em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mtight"><span class="mord mathbf mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7385428571428572em;"><span style="top:-2.214em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight">âˆ¥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913142857142857em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> <p>å¯¹æ¯”ä¸€ä¸‹å¯ä»¥çœ‹å‡ºï¼Œåœ¨è®¡ç®—æ¯ä¸ª expert çš„æŸå¤±ä¹‹åï¼Œå…ˆæŠŠå®ƒç»™æŒ‡æ•°åŒ–äº†å†è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œæœ€åå–äº†logã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæˆ‘ä»¬åœ¨è®ºæ–‡ä¸­ç»å¸¸è§åˆ°çš„æŠ€å·§ã€‚è¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸€ä¸‹äºŒè€…åœ¨åå‘ä¼ æ’­çš„æ—¶å€™æœ‰ä»€ä¹ˆæ ·çš„æ•ˆæœï¼Œä½¿ç”¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>E</mi><mi>c</mi></msup></mrow><annotation encoding="application/x-tex">E^c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span></span> å¯¹ ç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ª expert çš„è¾“å‡ºæ±‚å¯¼ï¼Œåˆ†åˆ«å¾—åˆ°ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161500648.png" alt="image-20220716150032601"></p> <p>å¯ä»¥çœ‹åˆ°ï¼Œå‰è€…çš„å¯¼æ•°ï¼Œåªä¼šè·Ÿå½“å‰ expert æœ‰å…³ï¼Œä½†åè€…åˆ™è¿˜è€ƒè™‘å…¶ä»– experts è·Ÿå½“å‰ sample <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">c</span></span></span></span> çš„åŒ¹é…ç¨‹åº¦ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœå½“å‰ sample è·Ÿå…¶ä»–çš„ experts ä¹Ÿæ¯”è¾ƒåŒ¹é…ï¼Œé‚£ä¹ˆ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>E</mi><mi>c</mi></msup></mrow><annotation encoding="application/x-tex">E^c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span></span> å¯¹ ç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ª expert çš„è¾“å‡ºçš„å¯¼æ•°ä¹Ÿä¼šç›¸å¯¹æ›´å°ä¸€ä¸‹ã€‚ï¼ˆå…¶å®çœ‹è¿™ä¸ªå…¬å¼ï¼Œè·Ÿæˆ‘ä»¬ç°åœ¨éåœ°çš„å¯¹æ¯”å­¦ä¹ lossçœŸçš„å¾ˆåƒï¼å¾ˆå¤šé“ç†éƒ½æ˜¯ç›¸é€šçš„ï¼‰</p> <p>ä»¥ä¸Šå°±æ˜¯è¿™ç¯‡æ–‡ç« çš„ç†è®ºéƒ¨åˆ†ï¼Œå…¶å®å¾ˆç®€å•ï¼Œä½†å®ƒæåˆ°çš„MoEçš„è®¾è®¡ï¼Œå¯å‘äº†åç»­æ— æ•°çš„å·¥ä½œã€‚</p> <p>æ¥ä¸‹æ¥ä¸€ç¯‡åˆ™æ˜¯æ—¶éš”20å¤šå¹´åçš„å¦ä¸€ç¯‡ç»å…¸è®ºæ–‡ï¼Œå¯èƒ½ä¹Ÿæ˜¯å¤§å®¶æ›´ç†Ÿæ‚‰çš„MoEå·¥ä½œã€‚</p> <h3 id="_2-outrageously-large-neural-networks-the-sparsely-gated-mixture-of-experts-layer-iclr-17"><a href="#_2-outrageously-large-neural-networks-the-sparsely-gated-mixture-of-experts-layer-iclr-17" class="header-anchor">#</a> 2. Outrageously Large Neural Networks: The Sparsely-Gated Mixture-of-Experts Layer, ICLR'17</h3> <ul><li>æœŸåˆŠ/ä¼šè®®ï¼šICLR'17</li> <li>è®ºæ–‡é“¾æ¥ï¼šhttps://readpaper.com/paper/2952339051</li> <li>ä»£è¡¨æ€§ä½œè€…ï¼šQuoc Le, Geoffrey Hinton,  Jeff Dean</li></ul> <p>è¿™ç¯‡æ–‡ç« ï¼Œä»titleä¸Šå°±å¯ä»¥çœ‹å‡ºæ¥å®ƒçš„èƒŒæ™¯å’Œç›®çš„â€”â€”å¸Œæœ›åšå‡ºæå¤§çš„ç¥ç»ç½‘ç»œã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæœ‰å¾ˆå¤š <strong>conditional computational</strong> çš„å·¥ä½œï¼Œåœ¨ç†è®ºä¸Šå¯ä»¥åœ¨æœ‰é™çš„è®¡ç®—æˆæœ¬å†…æŠŠæ¨¡å‹åšçš„éå¸¸å¤§ï¼Œä½†æ˜¯é‚£äº›æ–¹æ³•åœ¨å…·ä½“å®ç°çš„æ—¶å€™ï¼Œæœ‰å„ç§å„æ ·çš„é—®é¢˜ã€‚è¿™ç¯‡æ–‡ç« æå‡ºäº† Sparsely-Gated Mixture-of-Experts layer ï¼Œå£°ç§°ç»ˆäºè§£å†³äº†ä¼ ç»Ÿ conditional computational çš„é—®é¢˜ï¼Œåœ¨ç‰ºç‰²æå°‘çš„è®¡ç®—æ•ˆç‡çš„æƒ…å†µä¸‹ï¼ŒæŠŠæ¨¡å‹è§„æ¨¡æå‡1000å¤šå€ã€‚</p> <h4 id="sparsely-gated-mixture-of-experts-layer"><a href="#sparsely-gated-mixture-of-experts-layer" class="header-anchor">#</a> Sparsely-Gated Mixture-of-Experts layer</h4> <p>è·Ÿ1991å¹´é‚£ä¸ªå·¥ä½œå¯¹æ¯”ï¼Œè¿™é‡Œçš„MoEä¸»è¦æœ‰ä¸¤ä¸ªåŒºåˆ«ï¼š</p> <ul><li><strong>Sparsely-Gated</strong>ï¼šä¸æ˜¯æ‰€æœ‰expertéƒ½ä¼šèµ·ä½œç”¨ï¼Œè€Œæ˜¯æå°‘æ•°çš„expertä¼šè¢«ä½¿ç”¨æ¥è¿›è¡Œæ¨ç†ã€‚è¿™ç§ç¨€ç–æ€§ï¼Œä¹Ÿä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµ·é‡çš„expertsæ¥æŠŠæ¨¡å‹å®¹é‡åšçš„è¶…çº§å¤§ã€‚</li> <li><strong>token-level</strong>ï¼šå‰é¢é‚£ä¸ªæ–‡ç« ï¼Œæ˜¯ sample-level çš„ï¼Œå³ä¸åŒçš„æ ·æœ¬ï¼Œä½¿ç”¨ä¸åŒçš„expertsï¼Œä½†æ˜¯è¿™ç¯‡åˆ™æ˜¯ token-level çš„ï¼Œä¸€ä¸ªå¥å­ä¸­ä¸åŒçš„tokenä½¿ç”¨ä¸åŒçš„expertsã€‚</li></ul> <p>è¿™ç¯‡æ–‡ç« æ˜¯åœ¨RNNçš„ç»“æ„ä¸ŠåŠ å…¥äº†MoE layerï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161627859.png" alt="image-20220716162727779"></p> <p>å¦‚å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªtokenå¯¹åº”çš„positionï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªMoE Layerï¼Œæ¯ä¸ªMoE layerä¸­åŒ…å«äº†ä¸€å †çš„expertsï¼Œæ¯ä¸ªexpertéƒ½æ˜¯ä¸€ä¸ªå°å‹çš„FFNï¼Œè¿˜æœ‰ä¸€ä¸ªgating networkä¼šæ ¹æ®å½“å‰positionçš„è¾“å…¥ï¼Œé€‰æ‹©å°‘æ•°å‡ ä¸ªexpertæ¥è¿›è¡Œè®¡ç®—ã€‚</p> <h4 id="gating-network"><a href="#gating-network" class="header-anchor">#</a> Gating Network</h4> <p>è®¾ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">G(x)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">E_i(x)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> åˆ†åˆ«æ˜¯ gating network å’Œç¬¬ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span> ä¸ª expert çš„è¾“å‡ºï¼Œé‚£ä¹ˆå¯¹äºåœ¨å½“å‰positionçš„è¾“å…¥xï¼Œè¾“å‡ºå°±æ˜¯æ‰€æœ‰ experts çš„åŠ æƒå’Œï¼š</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>y</mi><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>G</mi><mo stretchy="false">(</mo><mi>x</mi><msub><mo stretchy="false">)</mo><mi>i</mi></msub><msub><mi>E</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y = \sum^n_{i=1}G(x)_iE_i(x)
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p> <p>(è·Ÿç¬¬ä¸€ç¯‡è®ºæ–‡çš„ç¬¬ä¸€ä¸ªå…¬å¼ç±»ä¼¼)</p> <p>ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¯èƒ½æœ‰ä¸Šåƒä¸ª expertsï¼Œå¦‚æœæ¯ä¸ªéƒ½ç®—çš„è¯ï¼Œè®¡ç®—é‡ä¼šéå¸¸å¤§ï¼Œæ‰€ä»¥è¿™é‡Œçš„ä¸€ä¸ªå…³é”®å°±æ˜¯å¸Œæœ› G(x) çš„è¾“å‡ºæ˜¯ç¨€ç–çš„ï¼Œåªæœ‰éƒ¨åˆ†çš„ experts çš„æƒé‡æ˜¯å¤§äº 0 çš„ï¼Œå…¶ä½™ç­‰äº 0 çš„ expert ç›´æ¥ä¸å‚ä¸è®¡ç®—ã€‚</p> <p>é¦–å…ˆçœ‹ä¼ ç»Ÿçš„ gating network å¦‚ä½•è®¾è®¡ï¼š</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>G</mi><mi>Ïƒ</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>x</mi><mo>â‹…</mo><msub><mi>W</mi><mi>g</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">G_{\sigma}(x) = Softmax(x \cdot W_g)
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Ïƒ</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p> <p>ç„¶åï¼Œä½œè€…åŠ å…¥äº† sparsity å’Œ noiseï¼š</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>G</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>K</mi><mi>e</mi><mi>e</mi><mi>p</mi><mi>T</mi><mi>o</mi><mi>p</mi><mi>K</mi><mo stretchy="false">(</mo><mi>H</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>k</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>H</mi><mo stretchy="false">(</mo><mi>x</mi><msub><mo stretchy="false">)</mo><mi>i</mi></msub><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>â‹…</mo><msub><mi>W</mi><mi>g</mi></msub><msub><mo stretchy="false">)</mo><mi>i</mi></msub><mo>+</mo><mi>S</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>a</mi><mi>r</mi><mi>d</mi><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo>â‹…</mo><mi>S</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>p</mi><mi>l</mi><mi>u</mi><mi>s</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>x</mi><mo>â‹…</mo><msub><mi>W</mi><mrow><mi>n</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub><msub><mo stretchy="false">)</mo><mi>i</mi></msub><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>K</mi><mi>e</mi><mi>e</mi><mi>p</mi><mi>T</mi><mi>o</mi><mi>p</mi><mi>K</mi><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>k</mi><msub><mo stretchy="false">)</mo><mi>i</mi></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3600em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>v</mi><mi>i</mi></msub><mo separator="true">,</mo><mtext></mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>i</mi><mi>f</mi><mtext></mtext><msub><mi>v</mi><mi>i</mi></msub><mtext></mtext><mi>i</mi><mi>n</mi><mtext></mtext><mi>t</mi><mi>o</mi><mi>p</mi><mi>K</mi><mtext></mtext><mi>e</mi><mi>l</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>s</mi><mi mathvariant="normal">.</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi><mo separator="true">,</mo><mtext></mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi><mi mathvariant="normal">.</mi></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">G(x) = Softmax(KeepTopK(H(x),k)) \\
H(x)_i = (x \cdot W_g)_i + StandardNormal()\cdot Softplus((x \cdot W_{noise})_i)\\
KeepTopK(v,k)_i = 
\begin{cases} 
v_i,\ \ &amp;if\ v_i\ in\ topK\ elements. \\
-\infty,\ \ &amp;otherwise.
\end{cases}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">Kee</span><span class="mord mathnormal" style="margin-right:0.13889em;">pT</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">))</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">St</span><span class="mord mathnormal">an</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">ma</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.01968em;">tpl</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mopen">((</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">se</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Kee</span><span class="mord mathnormal" style="margin-right:0.13889em;">pT</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace"></span><span class="mspace"></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord">âˆ</span><span class="mpunct">,</span><span class="mspace"></span><span class="mspace"></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"></span><span class="mord mathnormal">in</span><span class="mspace"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace"></span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mord">.</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">se</span><span class="mord">.</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> <p>æ€»è€Œè¨€ä¹‹ï¼Œsparsity æ˜¯é€šè¿‡ TopK sampling çš„æ–¹å¼å®ç°çš„ï¼Œå¯¹äºé TopK çš„éƒ¨åˆ†ï¼Œç”±äºå€¼æ˜¯è´Ÿæ— ç©·ï¼Œè¿™æ ·åœ¨ç»è¿‡ softmax ä¹‹åå°±ä¼šå˜æˆ 0ï¼Œå°±ç›¸å½“äºå…³é—¨äº†ã€‚noise é¡¹åˆ™å¯ä»¥ä½¿å¾—ä¸åŒ expert çš„è´Ÿè½½æ›´åŠ å‡è¡¡ã€‚åœ¨å…·ä½“å®éªŒä¸­ï¼Œä½œè€…ä½¿ç”¨çš„K=2~4.</p> <h4 id="expert-balancing"><a href="#expert-balancing" class="header-anchor">#</a> Expert Balancing</h4> <p>ä½œè€…åœ¨å®éªŒä¸­å‘ç°ï¼Œä¸åŒ experts åœ¨ç«äº‰çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºç°â€œ<strong>èµ¢è€…é€šåƒ</strong>â€çš„ç°è±¡ï¼šå‰æœŸå˜ç°å¥½çš„ expert ä¼šæ›´å®¹æ˜“è¢« gating network é€‰æ‹©ï¼Œå¯¼è‡´æœ€ç»ˆåªæœ‰å°‘æ•°çš„å‡ ä¸ª experts çœŸæ­£èµ·ä½œç”¨ã€‚å› æ­¤ä½œè€…é¢å¤–å¢åŠ äº†ä¸€ä¸ª lossï¼Œæ¥ç¼“è§£è¿™ç§ä¸å¹³è¡¡ç°è±¡ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mi>m</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>âˆ‘</mo><mrow><mi>x</mi><mo>âˆˆ</mo><mi>X</mi></mrow></munder><mi>G</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>L</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo>=</mo><mi>Î»</mi><mo>â‹…</mo><mi>C</mi><mi>V</mi><mo stretchy="false">(</mo><mi>I</mi><mi>m</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">Importance(X) = \sum_{x \in X}G(x)\\
L(X) = \lambda \cdot CV(Importance(X))^2
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3717110000000003em;vertical-align:-1.321706em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8556639999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mrel mtight">âˆˆ</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.321706em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">Î»</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p> <p>å…¶ä¸­ X ä»£è¡¨çš„æ˜¯ä¸€ä¸ªbatchçš„æ ·æœ¬ï¼ŒæŠŠä¸€ä¸ªbatchæ‰€æœ‰æ ·æœ¬çš„gating weightsåŠ èµ·æ¥ï¼Œç„¶åè®¡ç®—å˜å¼‚ç³»æ•°ï¼ˆ coefficient of variationï¼‰ã€‚æ€»ä¹‹ï¼Œè¿™ä¸ªåæ˜ äº†ä¸åŒ experts ä¹‹é—´ä¸å¹³è¡¡çš„ç¨‹åº¦ã€‚æœ€åè¿™ä¸ª loss ä¼šåŠ åˆ°æ€»ä½“ loss ä¸­ï¼Œé¼“åŠ±ä¸åŒçš„ experts éƒ½å‘æŒ¥å„è‡ªçš„ä½œç”¨ã€‚</p> <p>ä¸Šé¢å°±æ˜¯ Sparsely-Gated MoEçš„ä¸»è¦ç†è®ºï¼Œä½œè€…ä¸»è¦åœ¨ language modeling å’Œ machine translation ä¸¤ä¸ªä»»åŠ¡ä¸Šåšäº†å®éªŒï¼Œå› ä¸ºè¿™ä¸¤ä¸ªä»»åŠ¡ï¼Œéƒ½æ˜¯ç‰¹åˆ«å—ç›Šäºå¤§æ•°æ®å’Œå¤§æ¨¡å‹çš„ï¼Œè€Œæœ¬æ–‡çš„MoEçš„ä½œç”¨ä¸»è¦å°±åœ¨äºæå¤§åœ°æ‰©å¤§äº†æ¨¡å‹å®¹é‡â€”â€”é€šè¿‡MoEï¼ŒæŠŠRNN-basedç½‘ç»œåšåˆ°äº†137Bï¼ˆ1.3åƒäº¿ï¼‰å‚æ•°çš„è§„æ¨¡ï¼Œè¿˜æ˜¯æŒºéœ‡æ’¼çš„ã€‚æ•ˆæœè‡ªç„¶ä¹Ÿæ˜¯æå¥½çš„ï¼Œæˆ‘å°±ä¸ç»†è¯´äº†ã€‚</p> <p>ç»è¿‡è®­ç»ƒå‘¢ï¼Œä½œè€…å‘ç°ä¸åŒçš„ experts ç¡®å®åˆ†åŒ–å‡ºäº†ä¸åŒçš„â€œä¸“ä¸šâ€ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207180909142.png" alt="image-20220718090955006"></p> <hr> <p>ä¸Šé¢çš„ä¸¤ç¯‡ï¼Œæ˜¯MoEç³»åˆ—å·¥ä½œçš„åŸºç¡€ï¼Œæ¥ä¸‹æ¥ä»‹ç»çš„å·¥ä½œï¼Œéƒ½æ˜¯è¿‘å‡ å¹´çš„æ¯”è¾ƒå‡ºåçš„å·¥ä½œï¼Œæˆ‘ä»¬ç®€å•è¿‡ä¸€ä¸‹ï¼š</p> <h2 id="ä½¿ç”¨-moe-å¼€å‘è¶…å¤§æ¨¡å‹"><a href="#ä½¿ç”¨-moe-å¼€å‘è¶…å¤§æ¨¡å‹" class="header-anchor">#</a> ä½¿ç”¨ MoE å¼€å‘è¶…å¤§æ¨¡å‹</h2> <h3 id="_3-gshard-scaling-giant-models-with-conditional-computation-and-automatic-sharding-iclr-21"><a href="#_3-gshard-scaling-giant-models-with-conditional-computation-and-automatic-sharding-iclr-21" class="header-anchor">#</a> 3. GShard: Scaling Giant Models with Conditional Computation and Automatic Sharding, ICLR'21</h3> <ul><li>æœŸåˆŠ/ä¼šè®®ï¼šICLR'21</li> <li>è®ºæ–‡é“¾æ¥ï¼šhttps://readpaper.com/paper/3040573126</li></ul> <p>GShardï¼ŒæŒ‰ç…§æ–‡ç« çš„è¯´æ³•ï¼Œæ˜¯ç¬¬ä¸€ä¸ªå°†MoEçš„æ€æƒ³æ‹“å±•åˆ°Transformerä¸Šçš„å·¥ä½œã€‚å…·ä½“çš„åšæ³•æ˜¯ï¼ŒæŠŠTransformerçš„encoderå’Œdecoderä¸­ï¼Œ<strong>æ¯éš”ä¸€ä¸ª</strong>ï¼ˆevery otherï¼‰çš„FFNå±‚ï¼Œæ›¿æ¢æˆposition-wise çš„ MoE å±‚ï¼Œä½¿ç”¨çš„éƒ½æ˜¯ Top-2 gating networkã€‚</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161745948.png" alt="image-20220716174537884"></p> <p>æ–‡ä¸­è¿˜æåˆ°äº†å¾ˆå¤šå…¶ä»–è®¾è®¡ï¼š</p> <ul><li>Expert capacity balancingï¼šå¼ºåˆ¶æ¯ä¸ªexpertå¤„ç†çš„tokensæ•°é‡åœ¨ä¸€å®šèŒƒå›´å†…</li> <li>Local group dispatchingï¼šé€šè¿‡æŠŠä¸€ä¸ªbatchå†…æ‰€æœ‰çš„tokensåˆ†ç»„ï¼Œæ¥å®ç°å¹¶è¡ŒåŒ–è®¡ç®—</li> <li>Auxiliary lossï¼šä¹Ÿæ˜¯ä¸ºäº†ç¼“è§£â€œèµ¢è€…é€šåƒâ€é—®é¢˜</li> <li>Random routingï¼šåœ¨Top-2 gatingçš„è®¾è®¡ä¸‹ï¼Œä¸¤ä¸ªexpertå¦‚ä½•æ›´é«˜æ•ˆåœ°è¿›è¡Œrouting</li></ul> <p>å…·ä½“ç»†èŠ‚è§è®ºæ–‡å§ã€‚</p> <h3 id="_4-switch-transformers-scaling-to-trillion-parameter-models-with-simple-and-efficient-sparsity-jmlr-22"><a href="#_4-switch-transformers-scaling-to-trillion-parameter-models-with-simple-and-efficient-sparsity-jmlr-22" class="header-anchor">#</a> 4. Switch Transformers: Scaling to Trillion Parameter Models with Simple and Efficient Sparsity, JMLR'22</h3> <ul><li>æœŸåˆŠ/ä¼šè®®ï¼šJMLR'22</li> <li>è®ºæ–‡é“¾æ¥ï¼šhttps://readpaper.com/paper/4568736324836663297</li></ul> <p>è™½ç„¶å‘è¡¨æ˜¯2022å¹´æ‰åœ¨å‘è¡¨åœ¨JMLRä¸Šï¼ŒSwith Transformerå®é™…ä¸Šåœ¨21å¹´å°±æå‡ºäº†ã€‚å®ƒæ˜¯åœ¨T5æ¨¡å‹çš„åŸºç¡€ä¸ŠåŠ å…¥äº†MoEè®¾è®¡ï¼Œå¹¶åœ¨C4æ•°æ®é›†ä¸Šé¢„è®­ç»ƒï¼Œå¾—åˆ°äº†ä¸€ä¸ªâ€œåˆå¿«åˆå¥½â€çš„é¢„è®­ç»ƒå¤§æ¨¡å‹ã€‚</p> <p>Swith Transformer çš„ä¸»è¦äº®ç‚¹åœ¨äºâ€”â€”ç®€åŒ–äº†MoEçš„routingç®—æ³•ï¼Œä»è€Œå¤§å¤§æé«˜äº†è®¡ç®—æ•ˆç‡ã€‚</p> <p>ç»“æ„å¦‚ä¸‹ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161809329.png" alt="image-20220716180913285"></p> <p>Swith Transformer åœ¨è®ºæ–‡ä¸­æåˆ°å…¶è®¾è®¡çš„æŒ‡å¯¼åŸåˆ™æ˜¯â€”â€”<strong>å°½å¯èƒ½åœ°æŠŠTransformeræ¨¡å‹çš„å‚æ•°é‡åšå¤§ï¼</strong>ï¼ˆåŒæ—¶ä»¥ä¸€ç§ç®€å•é«˜æ•ˆçš„å®ç°æ–¹å¼ï¼‰</p> <p>è·Ÿå…¶ä»–MoEæ¨¡å‹çš„ä¸€ä¸ªæ˜¾è‘—ä¸åŒå°±æ˜¯ï¼Œ<strong>Switch Transformer çš„ gating network æ¯æ¬¡åª route åˆ° 1 ä¸ª expert</strong>ï¼Œè€Œå…¶ä»–çš„æ¨¡å‹éƒ½æ˜¯è‡³å°‘2ä¸ªã€‚è¿™æ ·å°±æ˜¯æœ€ç¨€ç–çš„MoEäº†ï¼Œå› æ­¤å•å•ä»MoE layerçš„è®¡ç®—æ•ˆç‡ä¸Šè®²æ˜¯æœ€é«˜çš„äº†ã€‚</p> <p>ä¸‹å›¾å±•ç¤ºäº†åœ¨åŒæ ·çš„è®¡ç®—å¼€é”€ä¸‹ï¼Œå¢å¤§ experts ä¸ªæ•°å¸¦æ¥çš„æ€§èƒ½æå‡ï¼Œåæ­£å°±æ˜¯å…¨é¢åŠæ‰“T5ï¼Œè€Œä¸”æ•ˆç‡è¿˜ä¸€æ ·ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161830811.png" alt="image-20220716183038769"></p> <h3 id="_5-glam-efficient-scaling-of-language-models-with-mixture-of-experts-2021"><a href="#_5-glam-efficient-scaling-of-language-models-with-mixture-of-experts-2021" class="header-anchor">#</a> 5. GLaM: Efficient Scaling of Language Models with Mixture-of-Experts, 2021</h3> <ul><li>å¹´ä»½ï¼š2021</li> <li>è®ºæ–‡é“¾æ¥ï¼šhttps://readpaper.com/paper/4568736324836663297</li> <li>Google Blogï¼šhttps://ai.googleblog.com/2021/12/more-efficient-in-context-learning-with.html</li></ul> <p>è¿™æ˜¯Googleåœ¨2021å¹´æ¨å‡ºçš„ä¸€ä¸ªè¶…å¤§æ¨¡å‹ï¼Œæ¯”GPT-3å¤§ä¸‰å€ï¼Œä½†æ˜¯ç”±äºä½¿ç”¨äº†Sparse MoEçš„è®¾è®¡ï¼Œè®­ç»ƒæˆæœ¬å´åªæœ‰GPT-3çš„1/3ï¼Œè€Œä¸”åœ¨29ä¸ªNLPä»»åŠ¡ä¸Šè¶…è¶Šäº†GPT-3ã€‚</p> <p>ä¸‹é¢è¿™ä¸ªæ¥è‡ªGoogle Blogçš„åŠ¨å›¾å¾ˆå½¢è±¡åœ°å±•ç¤ºäº†GLaMçš„ç»“æ„ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161754344.gif" alt="glam"></p> <p>å…¶å®æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè·ŸGShardå‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161800083.png" alt="image-20220716180053052"></p> <p>ä¸Šè¡¨å±•ç¤ºäº†GLaMè·Ÿå…¶ä»–å¤§æ¨¡å‹çš„å¯¹æ¯”ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶GLaMçš„æ€»å‚æ•°é‡æœ‰1.2Tï¼Œä½†æ˜¯åœ¨è®¡ç®—å¼å®é™…æ¿€æ´»çš„å‚æ•°é‡åªæœ‰96Bï¼Œæ‰€ä»¥åœ¨inferenceçš„æ—¶å€™ï¼Œæ¯”GPT-3ç­‰dense modelè¦å¿«å¾—å¤šã€‚</p> <p>GLaMä½¿ç”¨çš„æ•°æ®é‡ä¹Ÿæ¯”Switch-Transformerç­‰è¦å¤§å¾—å¤šï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161836969.png" alt="image-20220716183601929"></p> <p>åæ­£æœ€ç»ˆçš„ç»“æœï¼Œæ˜¯ä¸€ä¸ªæ¯”GPT-3æ›´å¿«æ›´å¼ºå¤§çš„é€šç”¨LMã€‚</p> <hr> <p>ä¸Šé¢çš„ä¸‰ç¯‡æ–‡ç« ï¼ˆGShardï¼ŒSwitch-Transformerï¼ŒGLaMï¼‰éƒ½æ˜¯å¸Œæœ›é€šè¿‡MoEçš„æ–¹å¼æŠŠæ¨¡å‹åšå¾—å°½å¯èƒ½çš„å¤§ï¼Œå¤§åˆ°æ™®é€šäººç©ä¸èµ·ï¼ˆåŠ¨è¾„ä½¿ç”¨å‡ ç™¾ä¸ªexpertsï¼‰ï¼Œä¸‹é¢ä»‹ç»çš„ä¸¤ç¯‡æ–‡ç« ï¼Œåˆ™æ›´åŠ äº²æ°‘ä¸€ç‚¹ï¼Œæ˜¯å…³äºå¦‚ä½•åˆ©ç”¨MoEå»å‹ç¼©æ¨¡å‹ã€æé«˜æ•ˆç‡ï¼š</p> <h2 id="ä½¿ç”¨-moe-æ¥ä½¿æ¨¡å‹è½»é‡åŒ–"><a href="#ä½¿ç”¨-moe-æ¥ä½¿æ¨¡å‹è½»é‡åŒ–" class="header-anchor">#</a> ä½¿ç”¨ MoE æ¥ä½¿æ¨¡å‹è½»é‡åŒ–</h2> <h3 id="_6-go-wider-instead-of-deeper-aaai-22"><a href="#_6-go-wider-instead-of-deeper-aaai-22" class="header-anchor">#</a> 6. Go Wider Instead of Deeper, AAAI'22</h3> <ul><li>æœŸåˆŠ/ä¼šè®®ï¼šAAAI'22</li> <li>è®ºæ–‡é“¾æ¥ï¼šhttps://readpaper.com/paper/3184020733</li></ul> <p>è¿™ä¸ªæ–‡ç« åå­—æ¯”è¾ƒå”¬äººï¼Œæ€è·¯ä¹Ÿæ¯”è¾ƒæ–°é¢–ï¼Œæ‰€ä»¥ä»‹ç»ä¸€ä¸‹ã€‚</p> <p>å®ƒæå‡ºäº†åä¸º WideNet çš„ç»“æ„ï¼Œæƒ³è§£å†³çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œå¦‚ä½•åœ¨å‹ç¼©æ¨¡å‹å‚æ•°é‡çš„æƒ…å†µä¸‹å–å¾—æ›´å¥½çš„æ•ˆæœã€‚æ¯”å¦‚Alberté€šè¿‡å‚æ•°å…±äº«æœºåˆ¶é™ä½äº†BERTçš„å‚æ•°é‡ï¼Œåƒtiny-bertä¹‹ç±»çš„åˆ™æ˜¯å‡å°‘äº†Transformerçš„å±‚æ•°ï¼Œä½†ä»–ä»¬çš„æ€§èƒ½éƒ½æœ‰äº†æ˜¾è‘—çš„ä¸‹é™ã€‚è¿™ç¯‡æ–‡ç« æå‡ºï¼Œ<strong>é¦–å…ˆé€šè¿‡å±‚ä¹‹é—´çš„å‚æ•°å…±äº«ï¼Œæ¥å‹ç¼©æ¨¡å‹å¤§å°ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨MoEçš„è®¾è®¡ï¼Œæ‰©å¤§æ¨¡å‹å®¹é‡</strong>ï¼ˆä½†æ˜¯æ¨¡å‹åœ¨feed forwardçš„æ—¶å€™è®¡ç®—é‡å¹¶æ²¡æ€ä¹ˆæå‡ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ°â€œæ—¢è¦æ¨¡å‹å‚æ•°å°‘ï¼Œè¿˜è¦æ¨¡å‹æ•ˆæœå¥½â€çš„æ•ˆæœã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161850414.png" alt="image-20220716185020358"></p> <p>å’‹ä¸€çœ‹ï¼Œä¼¼ä¹è·Ÿå‰é¢å‡ ä¸ªæ–‡ç« ä¸€æ¨¡ä¸€æ ·ï¼Œä½†è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦åŒºåˆ«ï¼š<strong>ä½¿ç”¨äº†recurrenceæœºåˆ¶</strong>ï¼Œå³å±‚ä¹‹é—´çš„å‚æ•°å…±äº«ï¼ˆMoE layerä¹Ÿå…±äº«ï¼‰ã€‚å¦å¤–ï¼Œä¸ºäº†å¢åŠ å­¦ä¹ çš„å¤šæ ·æ€§ï¼Œ<strong>normalization layer å¹¶ä¸å…±äº«</strong>ã€‚</p> <p>å…·ä½“å®ç°æ—¶ï¼Œè¿™é‡Œä½¿ç”¨æ€»å…±4ä¸ªexpertsï¼Œæ¯æ¬¡é€‰æ‹©Top2.</p> <p>è¿™æ ·åšçš„ç»“æœä¹ŸæŒºä¸é”™ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161904093.png" alt="image-20220716190421049"></p> <h3 id="_7-moebert-from-bert-to-mixture-of-experts-via-importance-guided-adaptation-naacl-22"><a href="#_7-moebert-from-bert-to-mixture-of-experts-via-importance-guided-adaptation-naacl-22" class="header-anchor">#</a> 7. MoEBERT: from BERT to Mixture-of-Experts via Importance-Guided Adaptation, NAACL'22</h3> <ul><li>æœŸåˆŠ/ä¼šè®®ï¼šNAACL'22</li> <li>è®ºæ–‡é“¾æ¥ï¼šhttps://readpaper.com/paper/4614341372211634177</li></ul> <p>è¿™ä¸€ç¯‡æ–‡ç« ï¼Œåˆ™æ˜¯ç»“åˆäº† MoE å’Œ knowledge distillationï¼Œåœ¨æå‡ inference é€Ÿåº¦çš„æƒ…å†µä¸‹ï¼Œè¿˜èƒ½æé«˜æ•ˆæœã€‚ä¸»è¦æƒ³è§£å†³ä¼ ç»Ÿçš„distillationæ–¹æ³•æ‰ç‚¹çš„é—®é¢˜ã€‚å…·ä½“åšæ³•æ˜¯æŠŠä¸€ä¸ª<strong>é¢„è®­ç»ƒå¥½</strong>çš„æ¨¡å‹ï¼ˆæ¯”å¦‚BERTï¼‰çš„FFNå±‚åˆ†è§£æˆå¤šä¸ªexpertsï¼Œè¿™æ ·åœ¨è®¡ç®—çš„æ—¶å€™é€Ÿåº¦å¯ä»¥å¤§å¹…æé«˜ï¼ˆç›¸å½“äºåªæ¿€æ´»åŸå§‹FFNç½‘ç»œçš„ä¸€éƒ¨åˆ†ï¼‰ã€‚ç„¶åå†é€šè¿‡æ¨¡å‹è’¸é¦æŠŠåŸå§‹æ¨¡å‹çš„çŸ¥è¯†è’¸é¦åˆ°MoEç‰ˆæœ¬çš„æ¨¡å‹ä¸­ã€‚</p> <p>æ³¨æ„è¿™ä¸ªæ–‡ç« å…¶å®è·Ÿä¸Šé¢ä»‹ç»çš„WideNetç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸ºäº†å‡å°‘å‚æ•°é‡ã€‚ä½†æœ‰ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼ŒWideNetæ˜¯è‡ªå·±ä»å¤´å¼€å§‹pre-trainçš„ï¼Œä½†æ˜¯æœ¬æ–‡çš„MoEBERTåˆ™æ˜¯æƒ³å°½å¯èƒ½åœ°æŠŠå·²ç»pre-trainå¥½çš„æ¨¡å‹è¿ç§»è¿‡æ¥ï¼Œé€šè¿‡distillationçš„æ–¹å¼åœ¨downstream taskä¸Šç›´æ¥å­¦ã€‚</p> <p>å› æ­¤ï¼Œå¦‚æœæŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼è®©æ¨¡å‹è‡ªç”±çš„å»å­¦ä¹ ä¸åŒçš„expertsï¼Œæ•ˆæœå¯èƒ½ä¸å¥½ï¼Œå› ä¸ºä½ æ²¡æœ‰å¤§é‡çš„æ•°æ®æ¥é¢„è®­ç»ƒã€‚æ‰€ä»¥è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªå…³é”®æ­¥éª¤â€”â€” <strong>Importance-Guided Adaptation</strong>ï¼š</p> <p>åœ¨æŠŠ Transformer ä¸­çš„FFN layer æ”¹é€ æˆ MoE layer æ—¶ï¼Œæˆ‘ä»¬å…ˆå»è®¡ç®— FFN layer å„ä¸ª neuron çš„ importanceï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161941255.png" alt="image-20220716194120204"></p> <p>è¿™é‡Œçš„ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>w</mi><mn>1</mn></msup></mrow><annotation encoding="application/x-tex">w^1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span> å’Œ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>w</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">w^2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> åˆ†åˆ«æ˜¯ FFN layer çš„æŸä¸ª neuron çš„è¾“å‡ºå’Œè¾“å‡º weights vectorï¼Œè¿™ä¸ª importance score ä¹Ÿè¢«åº”ç”¨äºå¾ˆå¤š model pruning çš„å·¥ä½œä¸­æ¥è¡¡é‡ç½‘ç»œçš„æŸä¸ª unit çš„é‡è¦æ€§ã€‚ç„¶åï¼Œåœ¨æŠŠ FFN åˆ†è§£çš„æ—¶å€™ï¼Œæˆ‘ä»¬<strong>å–æœ€é‡è¦çš„ä¸€éƒ¨åˆ† neurons åœ¨æ¯ä¸ªexpert ä¸­å…±äº«</strong>ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†å¹³å‡åˆ†é…åˆ°æ¯ä¸ª expertã€‚ç”±äºå…±äº«æœºåˆ¶çš„å­˜åœ¨ï¼Œä¸€å®šä¼šå¤šå‡ºä¸€äº› neuronsï¼Œè¿™éƒ¨åˆ†å°±ç›´æ¥ä¸¢å¼ƒã€‚ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¢åŠ æ¨¡å‹çš„å‚æ•°é‡ï¼Œè€Œåªæ˜¯æŠŠä¸€ä¸ªå…¨è¿æ¥çš„FFNå±‚ï¼Œåˆ†è§£æˆå¤šä¸ªsub-networksï¼ŒåŠ èµ·æ¥çš„å‚æ•°é‡å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ï¼‰</p> <p>è¿™ä¸ªç¤ºæ„å›¾å¾ˆå½¢è±¡ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207161950537.png" alt="image-20220716195043500"></p> <p>å¦å¤–ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹åœ¨äº expert routing çš„æ–¹å¼ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨ä¸€ä¸ª gating networkï¼Œè€Œæ˜¯<strong>åœ¨è®­ç»ƒå‰ç›´æ¥ç»™æ¯ä¸ª token éƒ½éšæœºåˆ†é…äº†ä¸€ä¸ª expert</strong> ï¼ˆå…·ä½“æ˜¯é€šè¿‡ä¸€ä¸ª hash functionï¼‰ã€‚</p> <p>åœ¨distillationéƒ¨åˆ†ï¼Œè¿™é‡Œä½¿ç”¨çš„é€å±‚çš„distillation MSE lossï¼Œä»¥åŠæœ€åé¢„æµ‹æ¦‚ç‡çš„ KL lossï¼ŒäºŒè€…åŠ èµ·æ¥å°±æ˜¯distillation æ‰€ä½¿ç”¨çš„ lossã€‚ç„¶åï¼Œå†å’ŒåŸæœ¬è‡ªå·±çš„ CE loss åŠ èµ·æ¥ï¼Œå°±æ˜¯æ€»ä½“æ¨¡å‹è®­ç»ƒçš„lossã€‚è¿™é‡Œæ˜¯ç›´æ¥åœ¨downstream datasetä¸Šé¢è¿›è¡Œè®­ç»ƒï¼Œå±äº task-specific distillationã€‚</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207162005411.png" alt="image-20220716200549383"></p> <p>å®éªŒçš„ç»“æœä¹ŸéªŒè¯äº† MoEBERTå¯ä»¥åœ¨åŒæ ·å‚æ•°é‡ï¼ˆeffective parametersï¼ŒMoE layerä¸­åªè€ƒè™‘è¢«æ¿€æ´»çš„expertsï¼‰çš„æƒ…å†µä¸‹è¶…è¶Šå…¶ä»– distillation baselinesã€‚</p> <p>å€¼å¾—æ³¨æ„çš„æ—¶ï¼Œè¿™é‡Œçš„baselinesä¸­ï¼Œtask-agnosticçš„æ–¹æ³•éƒ½ä½¿ç”¨äº†é¢„è®­ç»ƒï¼Œè€Œtask-specificéƒ½æ²¡æœ‰é¢„è®­ç»ƒã€‚æ€»ä½“ä¸Šçœ‹ï¼Œä½¿ç”¨äº†é¢„è®­ç»ƒçš„æ¨¡å‹ï¼Œæ•ˆæœéƒ½ä¼šæ›´å¥½ä¸€äº›ï¼Œä½†æ˜¯MoEBERTæ‰“ç ´äº†è¿™ä¸ªè§„å¾‹ï¼Œåœ¨åªä½¿ç”¨task datasetçš„æƒ…å†µä¸‹ï¼Œå–å¾—äº†SOTAçš„ç»“æœã€‚</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207162002921.png" alt="image-20220716200242882"></p> <p>å›¾aéªŒè¯äº†å‰é¢æåˆ°çš„ Importance-Guided Adaptation çš„æœ‰æ•ˆæ€§ï¼›å›¾båˆ™æ˜¯éªŒè¯äº†é€šè¿‡hash functionçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ trainable gatingçš„æ–¹å¼æ¥è¿›è¡Œrouting çš„æœ‰æ•ˆæ€§ã€‚</p> <hr> <h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="header-anchor">#</a> ç»“è¯­ï¼š</h2> <p>ä»¥ä¸Šæ€»ç»“äº†ä¸€ä¸‹ç¬”è€…åœ¨é˜…è¯» MoE ç›¸å…³æ–‡çŒ®æ—¶å°è±¡è¾ƒæ·±çš„å‡ ç¯‡æ–‡ç« ï¼Œç”±äºç¬”è€…ä¸»è¦ç ”ç©¶NLPæ–¹å‘ï¼Œæ‰€ä»¥é˜…è¯»çš„æ–‡çŒ®ä¹Ÿä¸»è¦æ˜¯NLPç›¸å…³çš„ï¼Œå…¶å® MoE åœ¨å„ä¸ªé¢†åŸŸä¸­çš„åº”ç”¨å·²ç»ååˆ†å¹¿æ³›ã€‚æ¯”å¦‚Googleæå‡ºçš„å¤šæ¨¡æ€MoEæ¨¡å‹â€”â€”LIMoEï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/beyondguo/mdnice_pictures/typora/202207162019899.gif" alt="limoe"></p> <p>å¦å¤–ï¼Œè·Ÿ MoE çš„ç†å¿µç›¸å…³çš„è¿˜æœ‰å¾ˆå¤šæœ‰è¶£çš„å·¥ä½œï¼Œæ¯”å¦‚ï¼š</p> <p><strong>Diverse Ensemble Evolution: Curriculum Data-Model Marriage</strong>, NeurIPS'18</p> <p><strong>Diversity and Depth in Per-Example Routing Models</strong>, ICLR'21</p> <p>MoE çš„æ€æƒ³ï¼Œå…¶å®ååˆ†ç¬¦åˆ Google æå‡ºçš„ Pathways æ„¿æ™¯ï¼Œä¹Ÿæ›´åŠ ç¬¦åˆé€šç”¨äººå·¥æ™ºèƒ½çš„è®¾è®¡ç†å¿µã€‚è™½ç„¶ç›®å‰ MoE çš„å·¥ä½œï¼Œå¤šæ•°éƒ½æ˜¯å¼€å‘â€œè¶…çº§æ¨¡å‹â€ï¼Œä½†æ˜¯ä¸Šé¢åˆ—ä¸¾çš„ä¸€äº›å·¥ä½œä¹Ÿè¡¨æ˜ MoE çš„ç”¨é€”è¿˜æœ‰å¾ˆå¤šï¼Œå¯ä»¥å¯å‘å¾ˆå¤šæ–¹å‘ä¸Šæ–¹æ³•çš„æ”¹è¿›ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.41fc4255.js" defer></script><script src="/assets/js/2.a266bdc2.js" defer></script><script src="/assets/js/84.f2c12c65.js" defer></script>
  </body>
</html>
